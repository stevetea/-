# 快速修复数据库连接

## 问题诊断

错误：`Access denied for user 'root'@'localhost' (using password: YES)`

**原因**：`.env` 文件中的密码与 MySQL root 用户的密码不匹配。

## 解决方案（选择一种）

### 方案 1：使用正确的 root 密码（推荐）

#### 步骤 1：找到正确的 MySQL root 密码

**方法 A：如果你知道密码**
- 直接在 `.env` 文件中填写正确的密码

**方法 B：测试密码**
```bash
# 在命令行测试
mysql -u root -p
# 输入你的密码，如果能登录，说明密码正确
```

**方法 C：查看 MySQL 配置文件**
- Windows: 通常在 `C:\ProgramData\MySQL\MySQL Server X.X\my.ini`
- 查找 `[mysqld]` 部分的配置

#### 步骤 2：修改 .env 文件

编辑 `backend/.env`：

```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=你的正确密码  # 👈 修改这里
DB_DATABASE=traceability
```

#### 步骤 3：重新测试

```bash
node test-db.js
```

---

### 方案 2：重置 MySQL root 密码

#### Windows 重置密码步骤：

1. **停止 MySQL 服务**
```powershell
Stop-Service -Name MySQL80  # 根据你的版本调整
```

2. **创建临时配置文件**

创建文件 `C:\mysql-init.txt`：
```
ALTER USER 'root'@'localhost' IDENTIFIED BY 'new_password';
```

3. **以跳过权限表模式启动 MySQL**
```powershell
cd "C:\Program Files\MySQL\MySQL Server 8.0\bin"
.\mysqld.exe --init-file=C:\mysql-init.txt --console
```

4. **在另一个窗口启动 MySQL 服务**
```powershell
Start-Service -Name MySQL80
```

5. **删除临时文件**
```powershell
Remove-Item C:\mysql-init.txt
```

6. **更新 .env 文件**
```env
DB_PASSWORD=new_password
```

---

### 方案 3：创建新用户（最简单，推荐）

如果不想修改 root 密码，可以创建一个新用户：

#### 步骤 1：使用 root 登录（如果可能）

```bash
# 如果 root 没有密码
mysql -u root

# 或者如果有密码
mysql -u root -p
```

#### 步骤 2：创建新用户和数据库

```sql
-- 创建数据库（如果不存在）
CREATE DATABASE IF NOT EXISTS traceability 
  DEFAULT CHARACTER SET utf8mb4 
  DEFAULT COLLATE utf8mb4_0900_ai_ci;

-- 创建新用户（密码设置为 123456，你可以改成其他）
CREATE USER 'traceability'@'localhost' IDENTIFIED BY '123456';

-- 授予权限
GRANT ALL PRIVILEGES ON traceability.* TO 'traceability'@'localhost';

-- 刷新权限
FLUSH PRIVILEGES;

-- 退出
EXIT;
```

#### 步骤 3：修改 .env 文件

```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=traceability  # 👈 使用新用户
DB_PASSWORD=123456    # 👈 新用户的密码
DB_DATABASE=traceability
```

#### 步骤 4：重新测试

```bash
node test-db.js
```

---

### 方案 4：使用空密码（仅开发环境，不推荐）

如果 MySQL root 用户没有密码：

#### 步骤 1：修改 .env 文件

```env
DB_PASSWORD=  # 留空，或者不写这一行
```

#### 步骤 2：重新测试

```bash
node test-db.js
```

---

## 推荐操作流程

### 最简单的方法（推荐）：

1. **尝试使用 MySQL Workbench 或命令行登录**
   ```bash
   mysql -u root -p
   ```
   如果能登录，说明你知道密码，直接填写到 `.env` 文件

2. **如果无法登录 root，创建新用户**（方案 3）

3. **执行数据库初始化**
   ```bash
   mysql -u traceability -p traceability < ../traceability_schema.sql
   ```

4. **测试连接**
   ```bash
   node test-db.js
   ```

5. **启动后端**
   ```bash
   npm run dev
   ```

---

## 验证步骤

完成配置后，运行：

```bash
node test-db.js
```

应该看到：
```
✅ 数据库连接成功！
✅ 查询测试成功
✅ 数据库中有 X 个表
```

如果看到这些，说明连接成功！

---

## 常见问题

### Q: 如何查看 MySQL 版本？

```bash
mysql --version
```

### Q: 如何查看 MySQL 服务名称？

**Windows:**
```powershell
Get-Service -Name MySQL*
```

### Q: 如何查看 MySQL 安装路径？

**Windows:**
- 默认路径：`C:\Program Files\MySQL\MySQL Server 8.0\`
- 或查看服务属性

### Q: 忘记 root 密码怎么办？

使用方案 2 重置密码，或使用方案 3 创建新用户。

