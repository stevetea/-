# 后端启动指南

## 快速开始

### 1. 安装 Node.js

确保已安装 Node.js 14+ 版本：
```bash
node -v
```

### 2. 安装依赖

```bash
cd backend
npm install
```

### 3. 配置环境变量

创建 `.env` 文件（复制 `env.example`）：

```bash
# Windows
copy env.example .env

# Linux/Mac
cp env.example .env
```

编辑 `.env` 文件，修改数据库配置：

```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=你的数据库密码
DB_DATABASE=traceability

JWT_SECRET=your_jwt_secret_key
PORT=3000
```

### 4. 创建数据库

1. 登录 MySQL
2. 执行 `traceability_schema.sql` 创建数据库和表

```sql
-- 在 MySQL 中执行
source traceability_schema.sql
```

### 5. 启动服务

**开发模式**（推荐，自动重启）：
```bash
npm run dev
```

**生产模式**：
```bash
npm start
```

### 6. 测试

访问 http://localhost:3000/health

应该看到：
```json
{
  "status": "ok",
  "timestamp": "2024-12-27T10:00:00.000Z"
}
```

## 测试API

### 测试登录接口

使用 Postman 或 curl：

```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "operatorName": "张园英",
    "password": "123456"
  }'
```

### 测试获取追溯信息

```bash
curl -X GET http://localhost:3000/api/blade/1/trace \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 常见问题

### 数据库连接失败

1. 检查 MySQL 服务是否启动
2. 检查 `.env` 中的数据库配置
3. 检查数据库用户权限

### 端口被占用

修改 `.env` 中的 `PORT` 配置

### 模块未找到

运行 `npm install` 重新安装依赖

