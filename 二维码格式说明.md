# 二维码格式说明

## 支持的格式

### 格式1：简单格式（推荐测试用）✅
```
B3
B123
```
- 仅包含叶片ID
- 最简单，推荐用于测试
- 系统会自动查询该叶片的所有工序记录

### 格式2：完整格式
```
B3|P1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11
```
- 包含叶片ID和所有工序记录ID
- 格式：`B{blade_id}|P{order}:{record_id},...`
- 用于完整追溯

### 格式3：部分工序格式
```
B3|P1:1,2:2,3:3
```
- 只包含部分工序记录ID

### 格式4：JSON格式（兼容）
```json
{"b":3,"p":{"1":1,"2":2}}
```

## 解析规则

1. **去除首尾空格**：自动处理
2. **大小写不敏感**：`B3` 和 `b3` 都可以
3. **兼容数字格式**：如果只有数字（如 `3`），也会尝试解析为叶片ID

## 测试用的二维码内容

### 推荐测试（最简单）
```
B3
```

### 其他测试用例
```
B1    # 已完成
B3    # 待质检（推荐）
B6    # 加工中
B8    # 阻塞
```

## 常见错误

### 错误1：格式不匹配
**错误信息**：`无法解析二维码格式`

**原因**：
- 二维码内容格式不正确
- 可能包含多余的空格或特殊字符

**解决**：
- 使用简单格式：`B3`
- 确保没有多余的空格
- 使用 `生成二维码工具.html` 生成

### 错误2：叶片ID不存在
**错误信息**：`叶片不存在`

**原因**：
- 数据库中不存在该叶片ID

**解决**：
- 先运行 `test_data.sql` 插入测试数据
- 使用存在的叶片ID（1-10）

## 快速测试步骤

1. **生成二维码**：
   - 打开 `生成二维码工具.html`
   - 输入叶片ID：`3`
   - 点击"生成二维码"

2. **测试扫码**：
   - 在小程序中点击"扫码追溯"
   - 扫描生成的二维码
   - 应该能正常解析并跳转

3. **验证结果**：
   - 查看控制台日志，应该看到解析结果
   - 如果解析失败，会显示错误信息

## 调试技巧

如果解析失败，可以在小程序控制台查看：
- 扫码结果（原始内容）
- 解析结果（bladeId 和 processIds）
- 错误信息

## 已修复的问题

✅ 支持简单格式 `B3`（之前只支持完整格式）
✅ 自动去除首尾空格
✅ 大小写不敏感
✅ 更详细的错误提示
✅ 兼容数字格式

