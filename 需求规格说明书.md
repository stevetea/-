# 叶片质量追溯系统 - 需求规格说明书

## 1. 系统功能需求

### 1.1 用户需求描述

叶片质量追溯系统是一个基于微信小程序的质量管理平台，旨在实现叶片生产全流程的数字化追溯和质量管控。系统通过记录叶片从合金预热到最终质检的11道工序的详细工艺参数、操作人员、执行时间等信息，并在第10道工序（雕刻二维码）时生成包含追溯信息的二维码，实现扫码即可追溯叶片完整生产流程的功能。

**系统主要约束条件：**
1. 系统运行在微信小程序平台，需支持微信扫码功能
2. 数据库采用MySQL 8.0+，字符集为utf8mb4
3. 工序必须按顺序执行，前一道工序成功后才能进行下一道工序
4. 支持返工机制，同一工序可多次尝试（通过attempt_no字段记录）
5. 工序失败时需记录失败原因，并更新叶片阻塞状态
6. 二维码内容需包含叶片ID和所有已完成工序的记录ID
7. 系统需区分三种角色：操作员（OPERATOR）、质检员（QC）、管理员（ADMIN）

**业务流程概述：**
- 叶片创建后进入"新建"状态
- 操作员按顺序完成11道工序：合金预热、冲压成型冷却、打磨边缘、涂陶瓷漆涂层加热、二次冲压、切除多余金属、压铸、拉床加工、液压机去除保护层、雕刻二维码、荧光检测
- 每道工序需记录工艺参数、操作员、执行时间、是否成功等信息
- 第10道工序（雕刻二维码）时，系统自动生成包含叶片ID和所有已完成工序ID的二维码
- 完成所有工序后，叶片进入"待质检"状态
- 质检员进行最终质检，记录质检结果
- 用户可通过扫描叶片上的二维码，查看完整的生产追溯信息

---

### 1.2 初始功能提取

#### 表2-1 功能需求点列表

| 编号 | 功能名称 | 使用人 | 功能描述 | 输入内容 | 输出内容 |
|------|---------|--------|---------|---------|---------|
| 1 | 用户登录认证 | 所有用户 | 通过微信授权登录，验证用户身份和角色权限 | 微信授权信息 | 用户信息、角色权限、登录状态 |
| 2 | 叶片信息创建 | 管理员/操作员 | 创建新的叶片记录，生成叶片序列号 | 叶片序列号（可选，系统自动生成） | 叶片ID、叶片序列号、创建时间 |
| 3 | 工序录入-合金预热 | 操作员 | 录入第1道工序（合金预热）的工艺参数和执行结果 | 叶片ID、操作员ID、炉号、气氛类型、目标温度、实际温度、升温速率、保温时间、实际保温时间、是否成功、失败原因、备注 | 工序记录ID、执行时间、尝试次数 |
| 4 | 工序录入-冲压成型冷却 | 操作员 | 录入第2道工序（冲压成型冷却）的工艺参数和执行结果 | 叶片ID、操作员ID、冲压机编号、模具编号、吨位、行程、速度、保压时间、冷却方式、冷却时间、冷却介质温度、是否成功、失败原因、备注 | 工序记录ID、执行时间、尝试次数 |
| 5 | 工序录入-打磨边缘 | 操作员 | 录入第3道工序（打磨边缘）的工艺参数和执行结果 | 叶片ID、操作员ID、打磨设备编号、砂轮目数、主轴转速、进给速度、边缘圆角半径、去除量、是否使用冷却液、冷却液类型、是否成功、失败原因、备注 | 工序记录ID、执行时间、尝试次数 |
| 6 | 工序录入-涂陶瓷漆涂层加热 | 操作员 | 录入第4道工序（涂陶瓷漆涂层加热）的工艺参数和执行结果 | 叶片ID、操作员ID、陶瓷漆批次号、粘度、喷涂压力、涂层厚度、烘箱编号、固化温度、固化时间、固化曲线、是否成功、失败原因、备注 | 工序记录ID、执行时间、尝试次数 |
| 7 | 工序录入-二次冲压 | 操作员 | 录入第5道工序（二次冲压）的工艺参数和执行结果 | 叶片ID、操作员ID、冲压机编号、模具编号、吨位、行程、速度、润滑剂类型、润滑剂用量、是否成功、失败原因、备注 | 工序记录ID、执行时间、尝试次数 |
| 8 | 工序录入-切除多余金属 | 操作员 | 录入第6道工序（切除多余金属）的工艺参数和执行结果 | 叶片ID、操作员ID、切除方式、刀具编号、切除余量、切削速度、毛刺高度、是否成功、失败原因、备注 | 工序记录ID、执行时间、尝试次数 |
| 9 | 工序录入-压铸 | 操作员 | 录入第7道工序（压铸）的工艺参数和执行结果 | 叶片ID、操作员ID、压铸机编号、合金批次号、熔炼温度、模温、注射压力、充型时间、保压压力、保压时间、冷却时间、射出重量、是否成功、失败原因、备注 | 工序记录ID、执行时间、尝试次数 |
| 10 | 工序录入-拉床加工 | 操作员 | 录入第8道工序（拉床加工）的工艺参数和执行结果 | 叶片ID、操作员ID、拉床设备编号、拉刀编号、拉削速度、每行程进给、切削油类型、走刀次数、目标尺寸、实测尺寸、是否成功、失败原因、备注 | 工序记录ID、执行时间、尝试次数 |
| 11 | 工序录入-液压机去除保护层 | 操作员 | 录入第9道工序（液压机去除保护层）的工艺参数和执行结果 | 叶片ID、操作员ID、液压机编号、压力、保压时间、方式、溶剂类型、溶剂温度、是否需要清洗、是否成功、失败原因、备注 | 工序记录ID、执行时间、尝试次数 |
| 12 | 工序录入-雕刻二维码 | 操作员 | 录入第10道工序（雕刻二维码），系统自动生成二维码内容并雕刻 | 叶片ID、操作员ID、激光设备编号、激光功率、扫描速度、焦距、标刻深度、是否成功、失败原因、备注 | 工序记录ID、二维码内容、二维码图片、执行时间 |
| 13 | 工序录入-荧光检测 | 操作员 | 录入第11道工序（荧光检测）的检测参数和结果 | 叶片ID、操作员ID、检测设备编号、荧光渗透剂批次号、停留时间、显像剂类型、显像时间、紫外强度、缺陷数量、最大缺陷长度、检查说明、是否成功、失败原因、备注 | 工序记录ID、执行时间、尝试次数 |
| 14 | 最终质检录入 | 质检员 | 录入最终质检结果，包括尺寸、外观、重量、缺陷等级等 | 叶片ID、质检员ID、质检结论、尺寸是否合格、外观是否合格、重量、关键尺寸、缺陷等级、不合格单号、备注 | 质检记录ID、质检时间 |
| 15 | 扫码追溯 | 所有用户 | 扫描叶片二维码，查看完整的生产追溯信息 | 二维码内容（包含叶片ID和工序ID） | 叶片基本信息、所有工序记录详情、质检信息、加工进度状态 |
| 16 | 叶片状态查询 | 所有用户 | 查询叶片的当前状态、加工进度、是否阻塞等信息 | 叶片ID或叶片序列号 | 叶片状态、当前工序进度、阻塞信息、最后更新时间 |
| 17 | 工序记录查询 | 操作员/管理员 | 查询指定叶片的某道工序的详细记录（包括返工记录） | 叶片ID、工序编码 | 该工序的所有尝试记录、工艺参数、执行结果 |
| 18 | 返工处理 | 操作员 | 当工序失败时，重新录入该工序，系统自动递增尝试次数 | 叶片ID、工序编码、新的工艺参数、执行结果 | 新的工序记录ID、新的尝试次数 |
| 19 | 叶片列表查询 | 管理员/质检员 | 按条件查询叶片列表（状态、时间范围等） | 查询条件（状态、时间范围、序列号等） | 叶片列表、总数、分页信息 |
| 20 | 人员管理 | 管理员 | 添加、修改、停用操作员和质检员信息 | 人员姓名、角色、是否在岗 | 人员ID、创建时间 |
| 21 | 工序定义管理 | 管理员 | 维护工序定义信息（工序编码、名称、顺序、表名映射） | 工序编码、工序名称、工序顺序、表名、是否质检工序 | 工序定义记录 |
| 22 | 数据统计 | 管理员 | 统计叶片加工情况、合格率、返工率等 | 统计条件（时间范围、工序等） | 统计数据、图表数据 |

---

### 1.3 系统需求描述

#### 1.3.1 用例模型

**主要参与者（Actor）：**
- **操作员（Operator）**：负责录入各道工序的工艺参数和执行结果
- **质检员（QC Inspector）**：负责最终质检录入
- **管理员（Admin）**：负责系统管理、人员管理、数据统计
- **追溯用户（Trace User）**：通过扫码查看追溯信息（可以是任意用户）

**用例图：**

```
                    ┌─────────────┐
                    │   操作员    │
                    └──────┬──────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
  ┌──────────┐      ┌──────────┐      ┌──────────┐
  │ 录入工序 │      │ 查询记录 │      │  返工处理│
  └──────────┘      └──────────┘      └──────────┘

                    ┌─────────────┐
                    │   质检员    │
                    └──────┬──────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
  ┌──────────┐      ┌──────────┐      ┌──────────┐
  │ 录入质检  │      │ 查询追溯 │      │ 扫码追溯 │
  └──────────┘      └──────────┘      └──────────┘

                    ┌─────────────┐
                    │   管理员    │
                    └──────┬──────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
  ┌──────────┐      ┌──────────┐      ┌──────────┐
  │ 人员管理 │      │ 数据统计 │      │ 系统管理 │
  └──────────┘      └──────────┘      └──────────┘

                    ┌─────────────┐
                    │  追溯用户   │
                    └──────┬──────┘
                           │
                           ▼
                    ┌──────────┐
                    │ 扫码追溯 │
                    └──────────┘
```

#### 1.3.2 核心用例详细描述

##### 用例1：录入工序记录

**用例名称**：录入工序记录

**参与者**：操作员

**前置条件**：
- 操作员已登录系统
- 叶片已创建
- 前一道工序已成功完成（或当前为第一道工序）

**主事件流**：
1. 操作员选择要录入的工序
2. 系统显示工序录入表单
3. 操作员输入或扫描叶片ID
4. 系统验证叶片是否存在，并检查工序顺序是否正确
5. 操作员填写工艺参数（根据工序类型显示不同字段）
6. 操作员选择执行结果（成功/失败）
7. 如果失败，操作员必须填写失败原因
8. 操作员提交表单
9. 系统保存工序记录，自动设置尝试次数
10. 如果成功，系统更新叶片状态和进度
11. 如果失败，系统更新叶片阻塞状态
12. 系统返回保存结果

**备选事件流**：
- 3a. 如果叶片不存在，系统提示错误
- 4a. 如果工序顺序不正确，系统提示"请先完成前一道工序"
- 7a. 如果失败但未填写失败原因，系统提示"失败时必须填写失败原因"
- 9a. 如果是第10道工序（雕刻二维码），系统自动生成二维码内容

**后置条件**：
- 工序记录已保存到数据库
- 叶片状态已更新

---

##### 用例2：扫码追溯

**用例名称**：扫码追溯

**参与者**：追溯用户（所有用户）

**前置条件**：
- 用户已打开小程序
- 叶片上已雕刻二维码

**主事件流**：
1. 用户点击"扫码追溯"按钮
2. 系统调用微信扫码API
3. 用户扫描叶片上的二维码
4. 系统获取二维码内容
5. 系统解析二维码内容，提取叶片ID和工序ID映射
6. 系统查询叶片基本信息
7. 系统查询所有工序记录
8. 系统查询质检信息
9. 系统查询叶片状态信息
10. 系统展示完整的追溯信息页面

**备选事件流**：
- 3a. 如果扫码失败，系统提示"请重新扫描"
- 5a. 如果二维码格式错误，系统提示"二维码格式不正确"
- 6a. 如果叶片不存在，系统提示"叶片不存在"

**后置条件**：
- 用户已查看追溯信息

---

##### 用例3：录入最终质检

**用例名称**：录入最终质检

**参与者**：质检员

**前置条件**：
- 质检员已登录系统
- 叶片已完成所有11道工序
- 叶片状态为"待质检"

**主事件流**：
1. 质检员选择要质检的叶片（可通过扫码或输入叶片ID）
2. 系统显示质检录入表单
3. 质检员填写质检结果（通过/不通过）
4. 质检员填写尺寸是否合格
5. 质检员填写外观是否合格
6. 质检员填写重量、关键尺寸等测量数据
7. 如果有缺陷，质检员选择缺陷等级
8. 如果不合格，质检员填写不合格单号
9. 质检员提交表单
10. 系统保存质检记录
11. 系统更新叶片状态（通过→完成，不通过→报废）
12. 系统返回保存结果

**备选事件流**：
- 1a. 如果叶片未完成所有工序，系统提示"叶片尚未完成所有工序"
- 3a. 如果选择不通过但未填写缺陷等级，系统提示"请选择缺陷等级"

**后置条件**：
- 质检记录已保存
- 叶片状态已更新

---

#### 1.3.3 分析类模型

**主要类及其职责：**

##### 1. Blade（叶片类）
- **属性**：
  - bladeId: Long（叶片ID）
  - bladeSn: String（叶片序列号）
  - status: Enum（状态：新建/加工中/阻塞/待质检/完成/报废）
  - createdAt: Timestamp（创建时间）
  - updatedAt: Timestamp（更新时间）
- **方法**：
  - create()：创建叶片
  - updateStatus()：更新状态
  - getCurrentProcess()：获取当前工序
  - isBlocked()：是否阻塞

##### 2. ProcessRecord（工序记录类）
- **属性**：
  - id: Long（记录ID）
  - bladeId: Long（叶片ID）
  - operatorId: Long（操作员ID）
  - processCode: String（工序编码）
  - performedAt: DateTime（执行时间）
  - isSuccess: Boolean（是否成功）
  - failReason: String（失败原因）
  - attemptNo: Integer（尝试次数）
  - processParams: Map<String, Object>（工艺参数）
- **方法**：
  - save()：保存工序记录
  - validate()：验证数据
  - getNextAttemptNo()：获取下次尝试次数

##### 3. ProcessDefinition（工序定义类）
- **属性**：
  - processCode: String（工序编码）
  - processName: String（工序名称）
  - processOrder: Integer（工序顺序）
  - tableName: String（对应表名）
  - isQc: Boolean（是否质检工序）
- **方法**：
  - getByOrder()：按顺序获取工序
  - getAllProcesses()：获取所有工序

##### 4. QRCodeGenerator（二维码生成器类）
- **属性**：
  - bladeId: Long（叶片ID）
  - processIds: Map<Integer, Long>（工序ID映射）
- **方法**：
  - generateContent()：生成二维码内容
  - generateImage()：生成二维码图片
  - parseContent()：解析二维码内容

##### 5. TraceService（追溯服务类）
- **方法**：
  - getTraceInfo()：获取完整追溯信息
  - parseQRCode()：解析二维码
  - getBladeInfo()：获取叶片信息
  - getProcessRecords()：获取工序记录
  - getQcInfo()：获取质检信息

##### 6. BladeProcessState（叶片工序状态类）
- **属性**：
  - bladeId: Long（叶片ID）
  - currentSuccessOrder: Integer（最后成功完成的工序顺序）
  - isBlocked: Boolean（是否阻塞）
  - blockedOrder: Integer（阻塞工序顺序）
  - blockedReason: String（阻塞原因）
- **方法**：
  - updateProgress()：更新进度
  - block()：设置阻塞
  - unblock()：解除阻塞

##### 7. QcInspection（质检记录类）
- **属性**：
  - id: Long（质检记录ID）
  - bladeId: Long（叶片ID）
  - inspectorId: Long（质检员ID）
  - result: Enum（通过/不通过）
  - dimensionPass: Boolean（尺寸是否合格）
  - surfacePass: Boolean（外观是否合格）
  - weight: Decimal（重量）
  - defectLevel: Enum（缺陷等级）
- **方法**：
  - save()：保存质检记录
  - validate()：验证数据

##### 8. OperatorUser（用户类）
- **属性**：
  - operatorId: Long（用户ID）
  - operatorName: String（姓名）
  - role: Enum（角色：操作员/质检/管理员）
  - isActive: Boolean（是否在岗）
- **方法**：
  - login()：登录
  - hasPermission()：检查权限

**类关系图：**

```
┌─────────────┐         ┌──────────────┐
│   Blade     │────────▶│ProcessRecord │
└─────────────┘   1:N   └──────────────┘
      │                        │
      │                        │
      ▼                        ▼
┌─────────────┐         ┌──────────────┐
│BladeProcess │         │ProcessDef    │
│   State     │         └──────────────┘
└─────────────┘
      │
      │
      ▼
┌─────────────┐
│QcInspection │
└─────────────┬───┘
          │
          ▼
    ┌──────────┐
    │Operator  │
    │  User    │
    └──────────┘

┌──────────────┐
│QRCodeGenerator│
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ TraceService │
└──────────────┘
```

#### 1.3.4 用例活动图

##### 活动图1：录入工序记录流程

```
开始
  │
  ▼
[操作员选择工序]
  │
  ▼
[输入/扫描叶片ID]
  │
  ▼
{验证叶片是否存在?}
  │ 否
  │───▶[提示错误]───▶结束
  │ 是
  ▼
{检查工序顺序?}
  │ 否
  │───▶[提示"请先完成前一道工序"]───▶结束
  │ 是
  ▼
[填写工艺参数]
  │
  ▼
[选择执行结果]
  │
  ▼
{是否成功?}
  │ 否
  │───▶[填写失败原因]
  │      │
  │      ▼
  │  {是否第10道工序?}
  │      │ 是
  │      │───▶[生成二维码内容]
  │      │ 否
  │      │
  │      ▼
  │  [保存工序记录]
  │      │
  │      ▼
  │  [更新叶片阻塞状态]
  │      │
  │      └───▶结束
  │ 是
  ▼
[保存工序记录]
  │
  ▼
[更新叶片状态和进度]
  │
  ▼
结束
```

##### 活动图2：扫码追溯流程

```
开始
  │
  ▼
[用户点击扫码按钮]
  │
  ▼
[调用微信扫码API]
  │
  ▼
{扫码成功?}
  │ 否
  │───▶[提示"扫码失败"]───▶结束
  │ 是
  ▼
[获取二维码内容]
  │
  ▼
[解析二维码内容]
  │
  ▼
{格式正确?}
  │ 否
  │───▶[提示"二维码格式错误"]───▶结束
  │ 是
  ▼
[提取叶片ID和工序ID]
  │
  ▼
[并行查询]
  │
  ├─▶[查询叶片基本信息]
  ├─▶[查询所有工序记录]
  ├─▶[查询质检信息]
  └─▶[查询叶片状态]
  │
  ▼
[汇总数据]
  │
  ▼
[展示追溯信息页面]
  │
  ▼
结束
```

##### 活动图3：录入最终质检流程

```
开始
  │
  ▼
[质检员选择叶片]
  │
  ▼
{叶片是否完成所有工序?}
  │ 否
  │───▶[提示"叶片尚未完成所有工序"]───▶结束
  │ 是
  ▼
[显示质检录入表单]
  │
  ▼
[填写质检结果]
  │
  ▼
{是否通过?}
  │ 否
  │───▶[填写缺陷等级]
  │      │
  │      ▼
  │  [填写不合格单号]
  │      │
  │      ▼
  │  [保存质检记录]
  │      │
  │      ▼
  │  [更新叶片状态为"报废"]
  │      │
  │      └───▶结束
  │ 是
  ▼
[填写测量数据]
  │
  ▼
[保存质检记录]
  │
  ▼
[更新叶片状态为"完成"]
  │
  ▼
结束
```

---

#### 1.3.5 类成员详细描述

##### Blade类详细描述

**类名**：Blade

**职责**：管理叶片的基本信息和状态

**属性**：
- `bladeId: Long` - 叶片ID，主键，自增
- `bladeSn: String` - 叶片序列号，业务唯一标识
- `status: Enum<BladeStatus>` - 叶片状态
  - NEW: 新建
  - IN_PROCESS: 加工中
  - BLOCKED: 阻塞
  - READY_FOR_QC: 待质检
  - COMPLETED: 完成
  - SCRAPPED: 报废
- `createdAt: Timestamp` - 创建时间
- `updatedAt: Timestamp` - 更新时间

**方法**：
- `create(bladeSn: String): Blade` - 创建新叶片
- `updateStatus(status: BladeStatus): void` - 更新状态
- `getCurrentProcess(): ProcessDefinition` - 获取当前应执行的工序
- `isBlocked(): Boolean` - 判断是否阻塞
- `canProceedToNextProcess(): Boolean` - 判断是否可以进入下一道工序

---

##### ProcessRecord类详细描述

**类名**：ProcessRecord

**职责**：管理工序记录的创建、验证和保存

**属性**：
- `id: Long` - 记录ID，主键，自增
- `bladeId: Long` - 关联的叶片ID
- `operatorId: Long` - 操作员ID
- `processCode: String` - 工序编码
- `performedAt: DateTime` - 执行时间
- `isSuccess: Boolean` - 是否成功
- `failReason: String` - 失败原因（失败时必填）
- `attemptNo: Integer` - 尝试次数
- `processParams: Map<String, Object>` - 工艺参数字典（根据工序类型不同）

**方法**：
- `save(): ProcessRecord` - 保存工序记录到数据库
- `validate(): ValidationResult` - 验证数据完整性
  - 检查必填字段
  - 检查失败时是否填写失败原因
  - 检查工序顺序是否正确
- `getNextAttemptNo(): Integer` - 获取下次尝试次数（当前最大+1）
- `toMap(): Map<String, Object>` - 转换为字典格式

---

##### QRCodeGenerator类详细描述

**类名**：QRCodeGenerator

**职责**：生成和解析二维码内容

**属性**：
- `bladeId: Long` - 叶片ID
- `processIds: Map<Integer, Long>` - 工序顺序号到记录ID的映射

**方法**：
- `generateContent(bladeId: Long, processIds: Map<Integer, Long>): String`
  - 生成二维码内容，格式：`B{bladeId}|P{order1}:{id1},{order2}:{id2},...`
  - 示例：`B123|P1:456,2:789,3:1011`
- `generateImage(content: String, options: QRCodeOptions): String`
  - 生成二维码图片（Base64格式）
  - options包含：宽度、容错级别等
- `parseContent(qrContent: String): QRCodeData`
  - 解析二维码内容
  - 返回：`{bladeId: Long, processIds: Map<Integer, Long>}`
- `validateContent(qrContent: String): Boolean` - 验证二维码格式

---

##### TraceService类详细描述

**类名**：TraceService

**职责**：提供追溯相关的业务逻辑

**方法**：
- `getTraceInfo(bladeId: Long): TraceInfo`
  - 获取完整的追溯信息
  - 返回包含：叶片信息、所有工序记录、质检信息、状态信息
- `parseQRCode(qrContent: String): TraceInfo`
  - 解析二维码并获取追溯信息
  - 内部调用parseContent和getTraceInfo
- `getBladeInfo(bladeId: Long): Blade` - 获取叶片基本信息
- `getProcessRecords(bladeId: Long): List<ProcessRecord>` - 获取所有工序记录
- `getQcInfo(bladeId: Long): QcInspection` - 获取质检信息
- `getProcessState(bladeId: Long): BladeProcessState` - 获取叶片状态

---

##### BladeProcessState类详细描述

**类名**：BladeProcessState

**职责**：管理叶片的加工进度和阻塞状态

**属性**：
- `bladeId: Long` - 叶片ID，主键
- `currentSuccessOrder: Integer` - 最后成功完成的工序顺序号
- `lastProcessCode: String` - 最后一次写入记录的工序编码
- `isBlocked: Boolean` - 是否阻塞
- `blockedOrder: Integer` - 阻塞发生的工序顺序号
- `blockedCode: String` - 阻塞发生的工序编码
- `blockedReason: String` - 阻塞原因
- `updatedAt: Timestamp` - 更新时间

**方法**：
- `updateProgress(processOrder: Integer, processCode: String): void`
  - 更新进度（工序成功时调用）
- `block(processOrder: Integer, processCode: String, reason: String): void`
  - 设置阻塞状态（工序失败时调用）
- `unblock(): void` - 解除阻塞（返工成功后调用）
- `getNextProcessOrder(): Integer` - 获取下一道工序的顺序号

---

#### 1.3.6 系统边界和接口

**系统边界**：
- 微信小程序前端（用户界面）
- 后端API服务（业务逻辑）
- MySQL数据库（数据存储）

**外部接口**：
- 微信登录API：用于用户身份认证
- 微信扫码API：用于扫描二维码
- 激光设备API（可选）：用于雕刻二维码

**内部接口**：
- RESTful API：前后端数据交互
- 数据库连接：数据持久化

---

## 2. 非功能性需求

### 2.1 性能需求
- 扫码响应时间：< 2秒
- 工序录入响应时间：< 1秒
- 追溯信息查询响应时间：< 3秒
- 支持并发用户数：≥ 100

### 2.2 安全需求
- 用户身份认证（微信授权）
- 角色权限控制
- 数据加密传输（HTTPS）
- SQL注入防护
- XSS攻击防护

### 2.3 可用性需求
- 系统可用性：≥ 99%
- 数据备份：每日自动备份
- 故障恢复时间：< 1小时

### 2.4 兼容性需求
- 支持微信小程序最新版本
- 支持iOS和Android系统
- 数据库：MySQL 8.0+

---

## 3. 数据字典

### 3.1 叶片状态枚举
- NEW：新建
- IN_PROCESS：加工中
- BLOCKED：阻塞
- READY_FOR_QC：待质检
- COMPLETED：完成
- SCRAPPED：报废

### 3.2 用户角色枚举
- OPERATOR：操作员
- QC：质检员
- ADMIN：管理员

### 3.3 工序编码定义
- ALLOY_PREHEAT：合金预热（顺序1）
- STAMP_FORM_COOL：冲压成型冷却（顺序2）
- EDGE_GRIND：打磨边缘（顺序3）
- CERAMIC_COAT_HEAT：涂陶瓷漆涂层加热（顺序4）
- SECOND_STAMP：二次冲压（顺序5）
- TRIM_EXCESS：切除多余金属（顺序6）
- DIE_CAST：压铸（顺序7）
- BROACH：拉床加工（顺序8）
- HYD_REMOVE_PROTECT：液压机去除保护层（顺序9）
- QR_ENGRAVE：雕刻二维码（顺序10）
- FLUORESCENT_TEST：荧光检测（顺序11）
- QC_INSPECTION：最终质检（顺序100）

---

## 4. 附录

### 4.1 术语表
- **叶片**：被追溯的生产对象
- **工序**：生产流程中的一个步骤
- **追溯**：通过二维码查询完整的生产信息
- **返工**：工序失败后重新执行该工序
- **阻塞**：工序失败导致流程中断的状态

### 4.2 参考资料
- MySQL 8.0 官方文档
- 微信小程序开发文档
- 二维码生成规范（ISO/IEC 18004）

---

**文档版本**：V1.0  
**编写日期**：2024年12月  
**编写人员**：系统分析团队

