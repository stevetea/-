# 叶片质量追溯系统 - 构件图和部署图（物理模型）

本文档采用UML构件图（Component Diagram）和部署图（Deployment Diagram）描述叶片质量追溯系统的体系结构物理模型，展示系统的物理组件和部署结构。

---

## 一、系统物理架构概述

系统采用**前后端分离**的分布式架构，物理上分为三个主要部分：

```
┌─────────────────────────────────────────────────────────────┐
│                    客户端层（Client Layer）                   │
│              微信小程序客户端（移动设备）                      │
└─────────────────────────────────────────────────────────────┘
                          ↕ HTTP/HTTPS
┌─────────────────────────────────────────────────────────────┐
│                    应用服务器层（Application Server）         │
│              Node.js + Express API Server                  │
└─────────────────────────────────────────────────────────────┘
                          ↕ SQL
┌─────────────────────────────────────────────────────────────┐
│                    数据库服务器层（Database Server）          │
│                    MySQL 8.0+ Database                     │
└─────────────────────────────────────────────────────────────┘
```

---

## 二、构件图（Component Diagram）

### 2.1 系统顶层构件图

```
┌─────────────────────────────────────────────────────────────────────┐
│                    叶片质量追溯系统                                    │
│              Blade Quality Traceability System                      │
└─────────────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  前端构件     │      │  后端构件     │      │  数据库构件    │
│  Frontend   │      │  Backend     │      │  Database    │
│  Component  │      │  Component   │      │  Component   │
└──────────────┘      └──────────────┘      └──────────────┘
```

### 2.2 前端构件详细图

```
┌─────────────────────────────────────────────────────────────┐
│                  前端构件（Frontend Component）               │
│                  微信小程序（uni-app）                         │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  页面组件     │      │  工具组件     │      │  配置组件     │
│  Pages      │      │  Utils      │      │  Config     │
│  Component  │      │  Component  │      │  Component  │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│  页面组件包含：                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  login.vue（登录页面组件）                              │  │
│  │  - 提供接口：login()                                   │  │
│  │  - 依赖：request组件、storage组件                       │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  blade-list.vue（叶片列表组件）                        │  │
│  │  - 提供接口：loadBladeList()                          │  │
│  │  - 依赖：request组件、config组件                      │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  process-input.vue（工序录入组件）                     │  │
│  │  - 提供接口：submitProcess()                         │  │
│  │  - 依赖：request组件                                  │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  qc-input.vue（质检录入组件）                          │  │
│  │  - 提供接口：submitQC()                              │  │
│  │  - 依赖：request组件                                  │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  scan.vue（扫码追溯组件）                              │  │
│  │  - 提供接口：scanQRCode()                             │  │
│  │  - 依赖：request组件、qrcode组件                      │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  trace-detail.vue（追溯详情组件）                      │  │
│  │  - 提供接口：loadTraceInfo()                         │  │
│  │  - 依赖：request组件                                  │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  工具组件包含：                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  request.js（网络请求组件）                            │  │
│  │  - 提供接口：get(), post(), put(), delete()          │  │
│  │  - 依赖：config组件                                    │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  storage.js（存储组件）                                │  │
│  │  - 提供接口：setItem(), getItem(), removeItem()     │  │
│  │  - 依赖：uni-app存储API                               │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  qrcode.js（二维码组件）                                │  │
│  │  - 提供接口：generateQRCode(), parseQRCode()        │  │
│  │  - 依赖：微信小程序二维码API                           │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  配置组件包含：                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  config.js（配置组件）                                 │  │
│  │  - 提供接口：API_BASE_URL, PROCESS_MAP,              │  │
│  │            BLADE_STATUS_MAP, USER_ROLE                │  │
│  │  - 无依赖                                              │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  mock.js（Mock组件）                                   │  │
│  │  - 提供接口：mockRequest()                            │  │
│  │  - 依赖：config组件                                    │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 后端构件详细图

```
┌─────────────────────────────────────────────────────────────┐
│                  后端构件（Backend Component）               │
│                  Node.js + Express                          │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  路由组件     │      │  中间件组件   │      │  配置组件     │
│  Routes      │      │  Middleware  │      │  Config     │
│  Component   │      │  Component   │      │  Component   │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  工具组件     │      │  应用入口     │      │  数据库连接   │
│  Utils       │      │  App Entry   │      │  DB Conn     │
│  Component   │      │  Component   │      │  Component   │
└──────────────┘      └──────────────┘      └──────────────┘
```

#### 2.3.1 路由组件详细结构

```
┌─────────────────────────────────────────────────────────────┐
│                  路由组件（Routes Component）                │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  业务路由     │      │  管理路由     │      │  工具路由     │
│  Business   │      │  Management │      │  Utility    │
│  Routes      │      │  Routes     │      │  Routes     │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│  业务路由组件：                                               │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  auth.js（认证路由组件）                                │  │
│  │  - 提供接口：POST /api/auth/login                     │  │
│  │  - 依赖：middleware组件、database组件                  │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  blade.js（叶片路由组件）                               │  │
│  │  - 提供接口：GET /api/blade/list                      │  │
│  │            GET /api/blade/:id/trace                  │  │
│  │  - 依赖：middleware组件、database组件                  │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  process.js（工序路由组件）                            │  │
│  │  - 提供接口：POST /api/process                       │  │
│  │  - 依赖：middleware组件、database组件                  │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  qc.js（质检路由组件）                                 │  │
│  │  - 提供接口：POST /api/qc                            │  │
│  │  - 依赖：middleware组件、database组件                  │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  管理路由组件：                                               │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  user.js（用户管理路由组件）                           │  │
│  │  - 提供接口：GET /api/user/list                      │  │
│  │            POST /api/user                            │  │
│  │  - 依赖：middleware组件、database组件                  │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  statistics.js（统计路由组件）                         │  │
│  │  - 提供接口：GET /api/statistics                     │  │
│  │  - 依赖：middleware组件、database组件                  │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

#### 2.3.2 中间件组件详细结构

```
┌─────────────────────────────────────────────────────────────┐
│                中间件组件（Middleware Component）            │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  认证中间件   │      │  权限中间件   │      │  日志中间件   │
│  Auth        │      │  Permission │      │  Logging     │
│  Middleware  │      │  Middleware  │      │  Middleware  │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│  认证中间件组件：                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  auth.js::authenticateToken()                        │  │
│  │  - 功能：JWT令牌验证                                  │  │
│  │  - 依赖：jsonwebtoken库                              │  │
│  │  - 提供接口：验证请求头中的JWT令牌                    │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  权限中间件组件：                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  auth.js::checkRole()                                │  │
│  │  - 功能：角色权限检查                                  │  │
│  │  - 依赖：认证中间件                                    │  │
│  │  - 提供接口：验证用户角色权限                          │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  日志中间件组件：                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  app.js::requestLogger()                             │  │
│  │  - 功能：请求日志记录                                  │  │
│  │  - 依赖：无                                            │  │
│  │  - 提供接口：记录请求方法、路径、参数                  │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

#### 2.3.3 配置组件详细结构

```
┌─────────────────────────────────────────────────────────────┐
│                  配置组件（Config Component）                │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  数据库配置   │      │  环境配置     │      │  应用配置     │
│  Database    │      │  Environment │      │  Application │
│  Config      │      │  Config      │      │  Config      │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│  数据库配置组件：                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  database.js（数据库连接池组件）                        │  │
│  │  - 提供接口：pool.execute()                           │  │
│  │  - 依赖：mysql2库、环境变量                            │  │
│  │  - 功能：MySQL连接池管理                               │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  环境配置组件：                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  .env（环境变量配置文件）                              │  │
│  │  - 提供配置：DB_HOST, DB_PORT, DB_USER,              │  │
│  │            DB_PASSWORD, DB_DATABASE,                │  │
│  │            JWT_SECRET, PORT                          │  │
│  │  - 依赖：dotenv库                                     │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  应用配置组件：                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  app.js（Express应用配置组件）                         │  │
│  │  - 提供接口：app.use(), app.listen()                 │  │
│  │  - 依赖：express库、路由组件、中间件组件               │  │
│  │  - 功能：Express应用初始化和路由注册                   │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

#### 2.3.4 工具组件详细结构

```
┌─────────────────────────────────────────────────────────────┐
│                  工具组件（Utils Component）                │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  二维码工具   │      │  检查工具     │      │  生成工具     │
│  QRCode      │      │  Check       │      │  Generate    │
│  Utils       │      │  Utils       │      │  Utils       │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│  二维码工具组件：                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  generate-qr.js（二维码生成组件）                      │  │
│  │  - 提供接口：generateQRContent()                      │  │
│  │  - 功能：生成二维码内容和图片                          │  │
│  │  - 依赖：qrcode库                                     │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 2.4 数据库构件详细图

```
┌─────────────────────────────────────────────────────────────┐
│                数据库构件（Database Component）             │
│                    MySQL 8.0+                              │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  数据表组件   │      │  索引组件     │      │  视图组件     │
│  Tables      │      │  Indexes     │      │  Views       │
│  Component   │      │  Component   │      │  Component   │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│  数据表组件包含：                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  blade（叶片表）                                      │  │
│  │  - 提供接口：SELECT, INSERT, UPDATE                  │  │
│  │  - 存储：叶片基本信息                                  │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  operator_user（人员表）                              │  │
│  │  - 提供接口：SELECT, INSERT, UPDATE                  │  │
│  │  - 存储：操作员、质检员、管理员信息                    │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  proc_*（11道工序表）                                 │  │
│  │  - 提供接口：SELECT, INSERT, UPDATE                  │  │
│  │  - 存储：各道工序的记录                                │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  qc_inspection（质检表）                              │  │
│  │  - 提供接口：SELECT, INSERT, UPDATE                  │  │
│  │  - 存储：质检记录                                      │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 2.5 外部依赖构件

```
┌─────────────────────────────────────────────────────────────┐
│                外部依赖构件（External Dependencies）        │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  第三方库     │      │  平台API     │      │  系统服务     │
│  3rd Party  │      │  Platform    │      │  System     │
│  Libraries  │      │  APIs        │      │  Services    │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│  第三方库组件：                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  express（Web框架）                                   │  │
│  │  - 提供接口：HTTP服务器、路由、中间件                  │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  mysql2（MySQL驱动）                                  │  │
│  │  - 提供接口：数据库连接、查询执行                      │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  jsonwebtoken（JWT库）                                │  │
│  │  - 提供接口：token生成、验证                            │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  cors（跨域支持）                                     │  │
│  │  - 提供接口：CORS中间件                                │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  平台API组件：                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  微信小程序API                                        │  │
│  │  - 提供接口：wx.request(), wx.scanCode(),            │  │
│  │            wx.login(), wx.getStorageSync()          │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  uni-app框架API                                       │  │
│  │  - 提供接口：uni.request(), uni.scanCode(),          │  │
│  │            uni.getStorageSync()                      │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  系统服务组件：                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Node.js运行时                                        │  │
│  │  - 提供接口：JavaScript执行环境                        │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  MySQL数据库服务                                      │  │
│  │  - 提供接口：SQL查询、事务管理                         │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 2.6 构件依赖关系图

```
┌──────────────┐
│  前端页面组件  │
│  Pages       │
└──────┬───────┘
       │ 依赖
       ├─────────────────┐
       │                 │
       ▼                 ▼
┌──────────────┐  ┌──────────────┐
│  前端工具组件  │  │  前端配置组件 │
│  Utils       │  │  Config     │
└──────┬───────┘  └──────────────┘
       │ 依赖
       ▼
┌──────────────┐
│  平台API组件  │
│  Platform    │
│  APIs        │
└──────────────┘

┌──────────────┐
│  后端路由组件  │
│  Routes      │
└──────┬───────┘
       │ 依赖
       ├─────────────────┐
       │                 │
       ▼                 ▼
┌──────────────┐  ┌──────────────┐
│  中间件组件   │  │  数据库连接   │
│  Middleware  │  │  DB Conn     │
└──────┬───────┘  └──────┬───────┘
       │ 依赖             │ 依赖
       ▼                 ▼
┌──────────────┐  ┌──────────────┐
│  第三方库     │  │  数据库组件   │
│  3rd Party   │  │  Database    │
│  Libraries   │  │  Component   │
└──────────────┘  └──────────────┘
```

---

## 三、部署图（Deployment Diagram）

### 3.1 系统部署架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                        部署环境（Deployment Environment）            │
└─────────────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  客户端节点   │      │  应用服务器   │      │  数据库服务器 │
│  Client      │      │  Application │      │  Database   │
│  Node        │      │  Server      │      │  Server     │
└──────────────┘      └──────────────┘      └──────────────┘
```

### 3.2 客户端节点部署图

```
┌─────────────────────────────────────────────────────────────┐
│                  客户端节点（Client Node）                    │
│                  移动设备（手机/平板）                         │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  微信客户端   │      │  小程序运行时  │      │  本地存储     │
│  WeChat      │      │  Mini Program│      │  Local       │
│  Client      │      │  Runtime      │      │  Storage     │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│  微信客户端：                                                  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  微信App（WeChat Application）                        │  │
│  │  - 操作系统：iOS / Android                           │  │
│  │  - 版本：微信最新版本                                 │  │
│  │  - 功能：提供小程序运行环境                            │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  小程序运行时：                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  叶片质量追溯小程序（Blade Traceability Mini Program）│  │
│  │  - 框架：uni-app                                      │  │
│  │  - 平台：微信小程序                                    │  │
│  │  - 组件：                                             │  │
│  │    • 页面组件（pages/）                                │  │
│  │    • 工具组件（utils/）                                │  │
│  │    • 配置组件（config/）                              │  │
│  │  - 存储：本地存储（token、用户信息）                    │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  本地存储：                                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  微信小程序本地存储（Local Storage）                   │  │
│  │  - 存储内容：                                          │  │
│  │    • JWT Token                                       │  │
│  │    • 用户信息（userInfo）                             │  │
│  │    • 配置信息                                         │  │
│  │  - 容量限制：10MB                                     │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 应用服务器节点部署图

```
┌─────────────────────────────────────────────────────────────┐
│              应用服务器节点（Application Server Node）       │
│                    Linux/Windows Server                    │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  Web服务器   │      │  应用运行时   │      │  进程管理     │
│  Web Server  │      │  App Runtime │      │  Process     │
│              │      │              │      │  Manager     │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│  Web服务器（可选）：                                           │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Nginx（反向代理服务器）                              │  │
│  │  - 端口：80（HTTP）、443（HTTPS）                     │  │
│  │  - 功能：反向代理、负载均衡、SSL终止                   │  │
│  │  - 配置：代理到Node.js应用（端口3000）                 │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  应用运行时：                                                  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Node.js运行时环境                                     │  │
│  │  - 版本：Node.js 14+                                  │  │
│  │  - 端口：3000（默认）                                  │  │
│  │  - 组件部署：                                         │  │
│  │    ┌────────────────────────────────────────────┐   │  │
│  │    │  Express应用（app.js）                      │   │  │
│  │    │  - 路由组件（routes/）                       │   │  │
│  │    │  - 中间件组件（middleware/）                 │   │  │
│  │    │  - 配置组件（config/）                       │   │  │
│  │    │  - 工具组件（utils/）                        │   │  │
│  │    └────────────────────────────────────────────┘   │  │
│  │  - 依赖库：                                          │  │
│  │    • express（Web框架）                             │  │
│  │    • mysql2（数据库驱动）                            │  │
│  │    • jsonwebtoken（JWT认证）                        │  │
│  │    • cors（跨域支持）                                │  │
│  │    • dotenv（环境变量）                              │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  进程管理：                                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  PM2（进程管理器，生产环境）                           │  │
│  │  - 功能：进程守护、自动重启、日志管理                   │  │
│  │  - 命令：pm2 start app.js --name traceability-api    │  │
│  │  - 配置：pm2 ecosystem.config.js                     │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  nodemon（开发环境，自动重启）                        │  │
│  │  - 功能：文件变更自动重启                              │  │
│  │  - 命令：npm run dev                                 │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 3.4 数据库服务器节点部署图

```
┌─────────────────────────────────────────────────────────────┐
│              数据库服务器节点（Database Server Node）       │
│                    Linux/Windows Server                    │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  数据库服务   │      │  数据存储     │      │  备份服务     │
│  Database    │      │  Data       │      │  Backup     │
│  Service     │      │  Storage    │      │  Service    │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│  数据库服务：                                                  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  MySQL 8.0+ 数据库服务器                               │  │
│  │  - 端口：3306（默认）                                  │  │
│  │  - 字符集：utf8mb4                                     │  │
│  │  - 数据库：traceability                                │  │
│  │  - 组件：                                             │  │
│  │    • 数据表（Tables）                                  │  │
│  │    • 索引（Indexes）                                   │  │
│  │    • 视图（Views，可选）                               │  │
│  │    • 存储过程（Stored Procedures，可选）              │  │
│  │  - 连接池：最大10个连接                                │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  数据存储：                                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  数据库文件存储                                        │  │
│  │  - 存储位置：/var/lib/mysql/traceability/            │  │
│  │  - 数据文件：.ibd文件（InnoDB）                       │  │
│  │  - 日志文件：binlog、redo log                          │  │
│  │  - 表空间：共享表空间或独立表空间                      │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  备份服务：                                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  数据库备份策略                                        │  │
│  │  - 全量备份：每日自动备份                              │  │
│  │  - 增量备份：每小时增量备份（可选）                     │  │
│  │  - 备份工具：mysqldump或Percona XtraBackup           │  │
│  │  - 备份存储：本地或远程存储                            │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 3.5 完整部署图（包含网络连接）

```
┌─────────────────────────────────────────────────────────────────────┐
│                        系统部署架构图                                │
└─────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────────┐
                    │   互联网/内网        │
                    │  Internet/Intranet  │
                    └──────────┬──────────┘
                               │
                               │ HTTP/HTTPS
                               │
                    ┌──────────▼──────────┐
                    │   客户端节点         │
                    │  Client Node        │
                    │  ┌──────────────┐   │
                    │  │ 微信小程序    │   │
                    │  │ Mini Program │   │
                    │  └──────────────┘   │
                    │  移动设备            │
                    │  (iOS/Android)     │
                    └─────────────────────┘
                               │
                               │ HTTP/HTTPS
                               │ (RESTful API)
                               │
                    ┌──────────▼──────────┐
                    │   应用服务器节点     │
                    │  Application Server │
                    │  ┌──────────────┐   │
                    │  │  Nginx       │   │
                    │  │  (可选)       │   │
                    │  └──────┬───────┘   │
                    │         │           │
                    │  ┌──────▼───────┐   │
                    │  │  Node.js     │   │
                    │  │  Express App │   │
                    │  │  Port: 3000  │   │
                    │  └──────────────┘   │
                    │  Linux/Windows      │
                    └──────────┬──────────┘
                               │
                               │ MySQL Protocol
                               │ (Port: 3306)
                               │
                    ┌──────────▼──────────┐
                    │   数据库服务器节点   │
                    │  Database Server   │
                    │  ┌──────────────┐   │
                    │  │  MySQL 8.0+  │   │
                    │  │  Port: 3306  │   │
                    │  └──────────────┘   │
                    │  Linux/Windows      │
                    └─────────────────────┘
```

### 3.6 开发环境部署图

```
┌─────────────────────────────────────────────────────────────┐
│                  开发环境部署架构（Development）              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────┐
│   开发机器           │
│  Development PC    │
│  ┌──────────────┐   │
│  │  HBuilderX   │   │
│  │  (IDE)      │   │
│  └──────┬───────┘   │
│         │           │
│  ┌──────▼───────┐   │
│  │  微信开发者工具 │   │
│  │  WeChat Dev  │   │
│  │  Tools      │   │
│  └──────────────┘   │
└─────────────────────┘
         │
         │ 本地网络
         │
┌────────▼──────────┐
│   本地服务器       │
│  Local Server    │
│  ┌──────────────┐ │
│  │  Node.js     │ │
│  │  Port: 3000  │ │
│  └──────┬───────┘ │
│         │         │
│  ┌──────▼───────┐ │
│  │  MySQL       │ │
│  │  Port: 3306  │ │
│  └──────────────┘ │
└───────────────────┘
```

### 3.7 生产环境部署图

```
┌─────────────────────────────────────────────────────────────┐
│                生产环境部署架构（Production）                 │
└─────────────────────────────────────────────────────────────┘

                    ┌─────────────────────┐
                    │   用户移动设备       │
                    │  User Devices      │
                    │  (iOS/Android)     │
                    └──────────┬──────────┘
                               │
                               │ HTTPS
                               │
                    ┌──────────▼──────────┐
                    │   负载均衡器         │
                    │  Load Balancer     │
                    │  (可选)             │
                    └──────────┬──────────┘
                               │
                ┌──────────────┼──────────────┐
                │              │              │
        ┌───────▼──────┐ ┌─────▼─────┐ ┌─────▼─────┐
        │  应用服务器1  │ │ 应用服务器2│ │ 应用服务器N│
        │  App Server  │ │ App Server│ │ App Server│
        │  ┌─────────┐ │ │ ┌───────┐ │ │ ┌───────┐ │
        │  │ Nginx  │ │ │ │ Nginx │ │ │ │ Nginx │ │
        │  └───┬─────┘ │ │ └───┬───┘ │ │ └───┬───┘ │
        │      │       │ │     │     │ │     │     │
        │  ┌───▼─────┐ │ │ ┌───▼───┐ │ │ ┌───▼───┐ │
        │  │ Node.js │ │ │ │Node.js│ │ │ │Node.js│ │
        │  │ PM2    │ │ │ │ PM2   │ │ │ │ PM2   │ │
        │  └─────────┘ │ │ └───────┘ │ │ └───────┘ │
        └──────┬───────┘ └─────┬─────┘ └─────┬─────┘
               │               │             │
               └───────────────┼─────────────┘
                               │
                    ┌──────────▼──────────┐
                    │   数据库服务器       │
                    │  Database Server   │
                    │  ┌──────────────┐   │
                    │  │  MySQL      │   │
                    │  │  Master     │   │
                    │  └──────┬───────┘   │
                    │         │           │
                    │  ┌──────▼───────┐   │
                    │  │  MySQL      │   │
                    │  │  Slave      │   │
                    │  │  (可选)     │   │
                    │  └──────────────┘   │
                    └─────────────────────┘
```

---

## 四、构件和部署说明

### 4.1 构件图符号说明

| 符号 | 说明 |
|------|------|
| `┌───┐` | 构件（Component）边界 |
| `│   │` | 构件内容 |
| `└───┘` | 构件边界结束 |
| `───▶` | 依赖关系（Dependency） |
| `◀───` | 提供接口（Provided Interface） |
| `───○` | 需要接口（Required Interface） |

### 4.2 部署图符号说明

| 符号 | 说明 |
|------|------|
| `┌───┐` | 节点（Node）边界 |
| `│   │` | 节点内容 |
| `└───┘` | 节点边界结束 |
| `───▶` | 通信路径（Communication Path） |
| `│` | 部署关系（Deployment） |

### 4.3 关键部署参数

#### 4.3.1 客户端节点参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 操作系统 | iOS 12+ / Android 8+ | 移动设备操作系统 |
| 微信版本 | 最新版本 | 微信小程序运行环境 |
| 存储容量 | 10MB | 本地存储限制 |
| 网络协议 | HTTP/HTTPS | 与服务器通信 |

#### 4.3.2 应用服务器节点参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 操作系统 | Linux / Windows Server | 服务器操作系统 |
| Node.js版本 | 14+ | JavaScript运行时 |
| 端口 | 3000 | 应用监听端口 |
| 进程管理 | PM2 / nodemon | 进程管理器 |
| 内存需求 | 512MB+ | 最小内存要求 |
| CPU需求 | 1核心+ | 最小CPU要求 |

#### 4.3.3 数据库服务器节点参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 操作系统 | Linux / Windows Server | 服务器操作系统 |
| MySQL版本 | 8.0+ | 数据库版本 |
| 端口 | 3306 | 数据库监听端口 |
| 字符集 | utf8mb4 | 数据库字符集 |
| 连接池大小 | 10 | 最大连接数 |
| 存储引擎 | InnoDB | 默认存储引擎 |

### 4.4 网络通信协议

| 通信路径 | 协议 | 端口 | 说明 |
|---------|------|------|------|
| 客户端 → 应用服务器 | HTTP/HTTPS | 80/443 | RESTful API通信 |
| 应用服务器 → 数据库服务器 | MySQL Protocol | 3306 | 数据库查询 |
| 客户端 → 微信服务器 | HTTPS | 443 | 微信API调用 |

### 4.5 部署环境对比

| 环境 | 客户端 | 应用服务器 | 数据库服务器 | 说明 |
|------|--------|-----------|-------------|------|
| **开发环境** | 微信开发者工具 | 本地Node.js | 本地MySQL | 单机部署，便于开发调试 |
| **测试环境** | 测试小程序 | 测试服务器 | 测试数据库 | 独立测试环境 |
| **生产环境** | 正式小程序 | 生产服务器集群 | 主从数据库 | 高可用、负载均衡 |

---

## 五、物理模型设计原则

### 5.1 可扩展性

- **水平扩展**：应用服务器可以部署多个实例，通过负载均衡分发请求
- **垂直扩展**：可以增加服务器硬件资源（CPU、内存、存储）
- **数据库扩展**：支持主从复制、读写分离

### 5.2 高可用性

- **应用服务器**：多实例部署，单点故障不影响服务
- **数据库服务器**：主从复制，主库故障可切换到从库
- **进程管理**：PM2自动重启，保证服务持续运行

### 5.3 安全性

- **HTTPS通信**：生产环境使用HTTPS加密传输
- **防火墙**：限制数据库端口仅允许应用服务器访问
- **认证授权**：JWT令牌验证，角色权限控制

### 5.4 性能优化

- **连接池**：数据库连接池管理，提高连接复用
- **缓存**：可以引入Redis缓存热点数据
- **CDN**：静态资源使用CDN加速

---

**文档版本：** 1.0  
**最后更新：** 2024-12-27  
**维护者：** 系统架构团队

