# 🚀 快速开始运行 - 完整步骤

## 📋 运行前检查清单

- [ ] MySQL 已安装并运行
- [ ] Node.js 已安装（14+ 版本）
- [ ] 数据库已创建
- [ ] .env 文件已配置

---

## 第一步：配置数据库

### 1.1 创建数据库

打开 MySQL 命令行或 MySQL Workbench，执行：

```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS traceability 
  DEFAULT CHARACTER SET utf8mb4 
  DEFAULT COLLATE utf8mb4_0900_ai_ci;

-- 使用数据库
USE traceability;

-- 执行建表SQL（在 MySQL 中执行）
source D:/yepian/traceability_schema.sql
```

**或者直接导入 SQL 文件：**
- 使用 MySQL Workbench：文件 → 运行 SQL 脚本 → 选择 `traceability_schema.sql`
- 使用命令行：`mysql -u root -p traceability < traceability_schema.sql`

### 1.2 插入测试数据（可选）

如果需要测试数据，执行 SQL 文件中的 INSERT 语句。

---

## 第二步：配置后端

### 2.1 进入后端目录

```bash
cd backend
```

### 2.2 安装依赖

```bash
npm install
```

### 2.3 配置环境变量

创建 `.env` 文件（如果还没有）：

```bash
# Windows
copy env.example .env

# Linux/Mac
cp env.example .env
```

编辑 `.env` 文件，修改以下配置：

```env
# 数据库配置（根据你的实际情况修改）
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=你的MySQL密码
DB_DATABASE=traceability

# JWT密钥（可以先用简单密钥测试）
JWT_SECRET=my_dev_secret_key_12345

# 服务器配置
PORT=3000
NODE_ENV=development
```

### 2.4 测试数据库连接

```bash
node test-db.js
```

如果看到 `✅ 数据库连接成功！`，说明配置正确。

### 2.5 启动后端服务

```bash
npm run dev
```

**成功标志：**
```
🚀 服务器运行在 http://localhost:3000
✅ 数据库连接成功
📝 API文档: http://localhost:3000/health
```

**如果看到数据库连接失败：**
- 检查 `.env` 文件中的数据库密码是否正确
- 运行 `node check-permissions.js` 检查权限
- 参考 `backend/快速修复数据库连接.md`

---

## 第三步：配置前端

### 3.1 关闭 Mock 模式

编辑 `叶片质量追溯/utils/mock.js`：

```javascript
export const USE_MOCK = false  // 改为 false，使用真实后端
```

### 3.2 配置 API 地址

编辑 `叶片质量追溯/utils/config.js`：

```javascript
// 确保 API 地址指向后端
const API_BASE_URL = 'http://localhost:3000/api'
```

### 3.3 使用 HBuilderX 运行

1. **打开 HBuilderX**
2. **文件 → 打开目录** → 选择 `叶片质量追溯` 文件夹
3. **点击"运行"按钮** → **运行到小程序模拟器** → **微信开发者工具**
4. 等待编译完成，微信开发者工具会自动打开

### 3.4 或使用微信开发者工具

1. **打开微信开发者工具**
2. **导入项目**
3. **选择目录**：`叶片质量追溯/unpackage/dist/dev/mp-weixin`
   - ⚠️ **重要**：必须选择编译后的目录，不是源代码目录
4. **填写 AppID**（可以使用测试号）
5. **点击"编译"**

---

## 第四步：测试运行

### 4.1 测试后端

打开浏览器访问：http://localhost:3000/health

应该看到：
```json
{
  "status": "ok",
  "timestamp": "2024-12-27T10:00:00.000Z"
}
```

### 4.2 测试登录

在小程序中：
1. 输入用户名：`张园英`（或数据库中存在的用户名）
2. 输入密码：任意值（当前版本不验证密码）
3. 点击"登录"

**成功标志：**
- 显示"登录成功"
- 跳转到首页
- 显示用户信息和功能菜单

### 4.3 测试扫码追溯

1. 点击"扫码追溯"
2. 手动输入叶片ID：`1`（如果数据库中有数据）
3. 点击"查询"
4. 查看追溯详情页

---

## 🔧 常见问题解决

### 问题 1：后端启动失败 - 数据库连接错误

**错误信息：**
```
❌ 数据库连接失败: Access denied for user 'root'@'localhost'
```

**解决方法：**
1. 检查 `.env` 文件中的 `DB_PASSWORD` 是否正确
2. 运行 `node test-db.js` 测试连接
3. 如果密码错误，修改 `.env` 文件
4. 如果忘记密码，参考 `backend/快速修复数据库连接.md`

### 问题 2：前端请求失败

**错误信息：**
```
网络请求失败
```

**解决方法：**
1. 确认后端服务正在运行（http://localhost:3000/health）
2. 检查 `utils/config.js` 中的 API 地址
3. 确认 `utils/mock.js` 中 `USE_MOCK = false`
4. 检查微信开发者工具的网络请求

### 问题 3：小程序编译失败

**错误信息：**
```
app.json 未找到
```

**解决方法：**
1. 使用 HBuilderX 编译，不要直接打开源代码目录
2. 或在微信开发者工具中打开 `unpackage/dist/dev/mp-weixin` 目录

### 问题 4：登录后页面空白

**解决方法：**
1. 检查控制台错误信息
2. 确认后端服务正常运行
3. 检查网络请求是否成功
4. 查看 `storage.js` 是否正确保存了用户信息

---

## 📝 运行顺序

1. ✅ **先启动后端**（必须）
   ```bash
   cd backend
   npm run dev
   ```

2. ✅ **再运行前端**（HBuilderX 或微信开发者工具）

3. ✅ **测试功能**

---

## 🎯 快速命令汇总

```bash
# 1. 进入后端目录
cd backend

# 2. 安装依赖（首次运行）
npm install

# 3. 测试数据库连接
node test-db.js

# 4. 启动后端
npm run dev

# 5. 在另一个终端，使用 HBuilderX 运行前端
# 或打开微信开发者工具导入编译后的项目
```

---

## ✅ 成功标志

### 后端成功：
- ✅ 看到 "🚀 服务器运行在 http://localhost:3000"
- ✅ 看到 "✅ 数据库连接成功"
- ✅ 访问 http://localhost:3000/health 返回正常

### 前端成功：
- ✅ 小程序正常显示登录页
- ✅ 登录后跳转到首页
- ✅ 可以看到功能菜单
- ✅ 可以扫码或输入叶片ID查看追溯信息

---

## 📞 需要帮助？

如果遇到问题：
1. 查看 `backend/启动指南.md`
2. 查看 `backend/快速修复数据库连接.md`
3. 查看 `叶片质量追溯/立即运行指南.md`
4. 检查控制台错误信息
5. 运行测试脚本诊断问题

---

## 🎉 开始运行！

按照上面的步骤，一步一步来，很快就能运行起来了！

**记住：先启动后端，再运行前端！**

