# 叶片质量追溯系统 - 包图体系结构逻辑模型（功能视角）

本文档采用UML包图（Package Diagram）从功能视角描述叶片质量追溯系统的体系结构逻辑模型，展示系统的功能模块组织和依赖关系。

---

## 一、系统总体架构

系统采用**前后端分离**的三层架构模式：

```
┌─────────────────────────────────────────────────────────┐
│                    表示层（Presentation Layer）          │
│              微信小程序（uni-app）                         │
└─────────────────────────────────────────────────────────┘
                          ↕ HTTP/HTTPS
┌─────────────────────────────────────────────────────────┐
│                    业务逻辑层（Business Logic Layer）    │
│              Node.js + Express API                      │
└─────────────────────────────────────────────────────────┘
                          ↕ SQL
┌─────────────────────────────────────────────────────────┐
│                    数据持久层（Data Persistence Layer）   │
│                    MySQL 8.0+                           │
└─────────────────────────────────────────────────────────┘
```

---

## 二、系统完整功能包图（Complete Function-Based Package Diagram）

### 2.1 系统整体包图

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    «system»                                         │
│                                    叶片质量追溯系统                                   │
│                          Blade Quality Traceability System                          │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          │
        ┌─────────────────────────────────┼─────────────────────────────────┐
        │                                 │                                 │
        ▼                                 ▼                                 ▼
┌──────────────────┐            ┌──────────────────┐            ┌──────────────────┐
│ «package»        │            │ «package»        │            │ «package»        │
│  Auth Function   │            │  Blade Management│            │  Process Input   │
│                  │            │                  │            │                  │
│ ┌──────────────┐ │            │ ┌──────────────┐ │            │ ┌──────────────┐ │
│ │ Frontend UI  │ │            │ │ Frontend UI  │ │            │ │ Frontend UI  │ │
│ │ (login.vue)  │ │            │ │(blade-list,  │ │            │ │(process-input│ │
│ └──────────────┘ │            │ │ blade-create)│ │            │ │ .vue)        │ │
│ ┌──────────────┐ │            │ └──────────────┘ │            │ └──────────────┘ │
│ │ Backend API  │ │            │ ┌──────────────┐ │            │ ┌──────────────┐ │
│ │ (auth.js)    │ │            │ │ Backend API  │ │            │ │ Backend API  │ │
│ └──────────────┘ │            │ │ (blade.js)   │ │            │ │ (process.js) │ │
│ ┌──────────────┐ │            │ └──────────────┘ │            │ └──────────────┘ │
│ │ Database     │ │            │ ┌──────────────┐ │            │ ┌──────────────┐ │
│ │(auth_account,│ │            │ │ Database     │ │            │ │ Database     │ │
│ │operator_user)│ │            │ │(blade,       │ │            │ │(proc_*,      │ │
│ └──────────────┘ │            │ │blade_process_│ │            │ │process_def)  │ │
└──────────────────┘            │ │state)        │ │            │ └──────────────┘ │
        │                       │ └──────────────┘ │            └──────────────────┘
        │                       └──────────────────┘                    │
        │                                │                              │
        │                                │                              │
        ▼                                ▼                              ▼
┌──────────────────┐            ┌──────────────────┐            ┌──────────────────┐
│ «package»        │            │ «package»        │            │ «package»        │
│  QC Function     │            │  Traceability     │            │  System          │
│                  │            │  Function         │            │  Management      │
│ ┌──────────────┐ │            │                  │            │                  │
│ │ Frontend UI  │ │            │ ┌──────────────┐ │            │ ┌──────────────┐ │
│ │(qc-input.vue)│ │            │ │ Frontend UI  │ │            │ │ Frontend UI  │ │
│ └──────────────┘ │            │ │(scan.vue,    │ │            │ │(user-manage, │ │
│ ┌──────────────┐ │            │ │ trace-detail)│ │            │ │statistics)   │ │
│ │ Backend API  │ │            │ └──────────────┘ │            │ └──────────────┘ │
│ │ (qc.js)      │ │            │ ┌──────────────┐ │            │ ┌──────────────┐ │
│ └──────────────┘ │            │ │ Backend API  │ │            │ │ Backend API  │ │
│ ┌──────────────┐ │            │ │(blade.js     │ │            │ │(user.js,     │ │
│ │ Database     │ │            │ │ trace)      │ │            │ │statistics.js)│ │
│ │(qc_inspection│ │            │ └──────────────┘ │            │ └──────────────┘ │
│ └──────────────┘ │            │ ┌──────────────┐ │            │ ┌──────────────┐ │
└──────────────────┘            │ │ Database     │ │            │ │ Database     │ │
        │                       │ │(All Tables) │ │            │ │(operator_user│ │
        │                       │ └──────────────┘ │            │ │,process_def)│ │
        │                       │ ┌──────────────┐ │            │ └──────────────┘ │
        │                       │ │ QRCode Gen   │ │            └──────────────────┘
        │                       │ │(generate-qr)│ │                    │
        │                       │ └──────────────┘ │                    │
        │                       └──────────────────┘                    │
        │                                │                              │
        │                                │                              │
        └────────────────────────────────┼──────────────────────────────┘
                                         │
                                         ▼
                            ┌──────────────────────────┐
                            │ «package»                │
                            │  Common Foundation       │
                            │                          │
                            │ ┌──────────────────────┐ │
                            │ │ Frontend Common      │ │
                            │ │(request,storage,    │ │
                            │ │ config)              │ │
                            │ └──────────────────────┘ │
                            │ ┌──────────────────────┐ │
                            │ │ Backend Common       │ │
                            │ │(middleware,config,  │ │
                            │ │ database)            │ │
                            │ └──────────────────────┘ │
                            └──────────────────────────┘
                                         │
                                         ▼
                            ┌──────────────────────────┐
                            │ «package»                │
                            │  Data Persistence        │
                            │                          │
                            │ ┌──────────────────────┐ │
                            │ │ Master Data          │ │
                            │ │(blade,operator_user, │ │
                            │ │ process_def)         │ │
                            │ └──────────────────────┘ │
                            │ ┌──────────────────────┐ │
                            │ │ Process Data         │ │
                            │ │(11 process tables)   │ │
                            │ └──────────────────────┘ │
                            │ ┌──────────────────────┐ │
                            │ │ State Data           │ │
                            │ │(blade_process_state) │ │
                            │ └──────────────────────┘ │
                            │ ┌──────────────────────┐ │
                            │ │ QC Data              │ │
                            │ │(qc_inspection)       │ │
                            │ └──────────────────────┘ │
                            │ ┌──────────────────────┐ │
                            │ │ Auth Data            │ │
                            │ │(auth_account)        │ │
                            │ └──────────────────────┘ │
                            └──────────────────────────┘
                                         │
                                         ▼
                            ┌──────────────────────────┐
                            │ «package»                │
                            │  External                 │
                            │                          │
                            │ ┌──────────────────────┐ │
                            │ │ WeChat API           │ │
                            │ │(login,scanCode)      │ │
                            │ └──────────────────────┘ │
                            │ ┌──────────────────────┐ │
                            │ │ File System          │ │
                            │ │(uploads,static)      │ │
                            │ └──────────────────────┘ │
                            └──────────────────────────┘
```

### 2.2 系统包图依赖关系说明

**依赖关系图例：**
- `───▶` 表示依赖关系（«uses»）
- 箭头方向：从依赖方指向被依赖方

**主要依赖关系：**
1. **认证功能包** → 公共基础包、数据持久包
2. **叶片管理包** → 认证功能包、公共基础包、数据持久包
3. **工序录入包** → 叶片管理包、认证功能包、公共基础包、数据持久包
4. **质检功能包** → 工序录入包、叶片管理包、认证功能包、公共基础包、数据持久包
5. **追溯功能包** → 所有业务功能包、公共基础包、数据持久包、外部包
6. **系统管理包** → 认证功能包、公共基础包、数据持久包
7. **数据统计包** → 所有业务功能包、公共基础包、数据持久包

---

## 三、认证功能包（Auth Function Package）

### 3.1 认证功能包图

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Auth Function Package                    │
│                    用户登录认证功能                           │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (Auth UI)   │      │  (Auth API)  │      │  (Auth Data) │
└──────────────┘      └──────────────┘      └──────────────┘
```

**包说明：**
- **Frontend (Auth UI)**：前端认证界面包
  - 页面：login.vue（登录页面）
  - 功能：用户登录、微信授权、Token存储
- **Backend (Auth API)**：后端认证API包
  - 路由：auth.js（认证路由）
  - 功能：用户登录验证、JWT Token生成、权限验证
- **Database (Auth Data)**：认证数据包
  - 表：auth_account（认证账户表）、operator_user（人员表）
  - 功能：存储用户认证信息、用户角色信息

---

## 四、叶片管理功能包（Blade Management Package）

### 4.1 叶片管理功能包图

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Blade Management Package                 │
│                    叶片信息管理功能                           │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (Blade UI)  │      │  (Blade API) │      │  (Blade Data)│
└──────────────┘      └──────────────┘      └──────────────┘
```

**包说明：**
- **Frontend (Blade UI)**：前端叶片管理界面包
  - 页面：blade-list.vue（叶片列表）、blade-create.vue（创建叶片）、blade-add.vue（添加叶片）
  - 功能：叶片列表查询、叶片创建、叶片状态查看
- **Backend (Blade API)**：后端叶片管理API包
  - 路由：blade.js（叶片路由）
  - 功能：叶片创建、叶片列表查询、叶片详情查询、叶片状态查询
- **Database (Blade Data)**：叶片数据包
  - 表：blade（叶片主表）、blade_process_state（叶片工序状态表）
  - 功能：存储叶片基本信息、叶片状态信息

---

## 五、工序录入功能包（Process Input Package）

### 5.1 工序录入功能包图

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Process Input Package                    │
│                    工序录入功能（11道工序）                   │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (Process UI)│      │  (Process API)│      │  (Process Data)│
└──────────────┘      └──────────────┘      └──────────────┘
```

**包说明：**
- **Frontend (Process UI)**：前端工序录入界面包
  - 页面：process-input.vue（工序录入页面）
  - 功能：工序参数录入、工序结果提交、返工处理
- **Backend (Process API)**：后端工序录入API包
  - 路由：process.js（工序路由）
  - 功能：工序记录保存、工序顺序验证、状态更新、阻塞处理
- **Database (Process Data)**：工序数据包
  - 表：11道工序表（proc_alloy_preheat、proc_stamp_form_cool等）、process_def（工序定义表）
  - 功能：存储工序记录、工序定义信息

**包含的11道工序：**
1. 合金预热（ALLOY_PREHEAT）
2. 冲压成型冷却（STAMP_FORM_COOL）
3. 打磨边缘（EDGE_GRIND）
4. 涂陶瓷漆涂层加热（CERAMIC_COAT_HEAT）
5. 二次冲压（SECOND_STAMP）
6. 切除多余金属（TRIM_EXCESS）
7. 压铸（DIE_CAST）
8. 拉床加工（BROACH）
9. 液压机去除保护层（HYD_REMOVE_PROTECT）
10. 雕刻二维码（QR_ENGRAVE）
11. 荧光检测（FLUORESCENT_TEST）

---

## 六、质检功能包（QC Function Package）

### 6.1 质检功能包图

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    QC Function Package                      │
│                    最终质检功能                               │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (QC UI)     │      │  (QC API)    │      │  (QC Data)   │
└──────────────┘      └──────────────┘      └──────────────┘
```

**包说明：**
- **Frontend (QC UI)**：前端质检界面包
  - 页面：qc-input.vue（质检录入页面）
  - 功能：质检结果录入、质检参数填写、质检结论提交
- **Backend (QC API)**：后端质检API包
  - 路由：qc.js（质检路由）
  - 功能：质检记录保存、叶片状态更新（完成/报废）
- **Database (QC Data)**：质检数据包
  - 表：qc_inspection（质检记录表）
  - 功能：存储质检记录、质检结果

---

## 七、追溯功能包（Traceability Function Package）

### 7.1 追溯功能包图

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Traceability Function Package            │
│                    追溯查询功能                               │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (Trace UI)  │      │  (Trace API) │      │  (Trace Data)│
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  QRCode      │      │  External    │      │  (All Data)  │
│  Generator   │      │  (WeChat API)│      │              │
└──────────────┘      └──────────────┘      └──────────────┘
```

**包说明：**
- **Frontend (Trace UI)**：前端追溯界面包
  - 页面：scan.vue（扫码页面）、trace-detail.vue（追溯详情页面）
  - 功能：二维码扫描、追溯信息展示、工序记录查看
- **Backend (Trace API)**：后端追溯API包
  - 路由：blade.js（追溯路由：GET /api/blade/:id/trace）
  - 功能：追溯信息查询、二维码解析、数据汇总
- **Database (Trace Data)**：追溯数据包
  - 表：所有相关表（blade、工序表、qc_inspection、blade_process_state）
  - 功能：提供完整的追溯数据
- **QRCode Generator**：二维码生成包
  - 工具：generate-qr.js（后端）、qrcode.js（前端）
  - 功能：二维码内容生成、二维码图片生成、二维码解析
- **External (WeChat API)**：外部微信API包
  - 功能：微信扫码API、二维码扫描

---

## 八、系统管理功能包（System Management Package）

### 8.1 系统管理功能包图

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    System Management Package                │
│                    系统管理功能                               │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  人员管理包   │      │  工序定义包   │      │  权限管理包   │
│  User        │      │  Process     │      │  Permission │
│  Management  │      │  Definition  │      │  Management  │
└──────────────┘      └──────────────┘      └──────────────┘
```

**包说明：**
- **User Management**：人员管理功能包
  - 前端：user-manage.vue（人员管理页面）
  - 后端：user.js（用户管理路由）
  - 数据库：operator_user（人员表）、auth_account（认证账户表）
  - 功能：人员添加、修改、停用、角色管理
- **Process Definition**：工序定义管理功能包
  - 后端：process_def相关功能
  - 数据库：process_def（工序定义表）
  - 功能：工序定义维护、工序顺序管理
- **Permission Management**：权限管理功能包
  - 后端：middleware/auth.js（权限中间件）
  - 功能：角色权限验证、访问控制

---

## 九、数据统计功能包（Statistics Function Package）

### 9.1 数据统计功能包图

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Statistics Function Package               │
│                    数据统计功能                               │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (Stats UI)  │      │  (Stats API) │      │  (Stats Data)│
└──────────────┘      └──────────────┘      └──────────────┘
```

**包说明：**
- **Frontend (Stats UI)**：前端统计界面包
  - 页面：statistics.vue（数据统计页面）
  - 功能：统计数据展示、图表展示、数据筛选
- **Backend (Stats API)**：后端统计API包
  - 路由：statistics.js（统计路由）
  - 功能：数据统计计算、合格率计算、返工率计算、报废率计算
- **Database (Stats Data)**：统计数据包
  - 表：所有业务表（blade、工序表、qc_inspection等）
  - 功能：提供统计数据源

---

## 十、公共基础包（Common Foundation Package）

### 10.1 公共基础包图

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Common Foundation Package                 │
│                    公共基础功能                               │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Shared      │
│  Common      │      │  Common      │      │  Utilities   │
└──────────────┘      └──────────────┘      └──────────────┘
```

**包说明：**
- **Frontend Common**：前端公共包
  - 工具：request.js（网络请求）、storage.js（本地存储）、config.js（配置）
  - 功能：通用工具函数、公共组件、配置管理
- **Backend Common**：后端公共包
  - 中间件：auth.js（认证中间件）、日志中间件
  - 配置：database.js（数据库配置）、环境配置
  - 功能：通用中间件、公共工具、配置管理
- **Shared Utilities**：共享工具包
  - 功能：二维码生成工具、数据验证工具、格式化工具

---

## 十一、数据持久包（Data Persistence Package）

### 11.1 数据持久包图

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Data Persistence Package                  │
│                    数据持久化层                               │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Master      │      │  Process     │      │  State       │
│  Data        │      │  Data       │      │  Data        │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  QC Data     │      │  Config      │      │  Auth Data   │
│              │      │  Data        │      │              │
└──────────────┘      └──────────────┘      └──────────────┘
```

**包说明：**
- **Master Data**：主数据包
  - 表：blade（叶片表）、operator_user（人员表）、process_def（工序定义表）
- **Process Data**：工序数据包
  - 表：11道工序表（proc_*）
- **State Data**：状态数据包
  - 表：blade_process_state（叶片工序状态表）
- **QC Data**：质检数据包
  - 表：qc_inspection（质检记录表）
- **Config Data**：配置数据包
  - 表：配置相关表
- **Auth Data**：认证数据包
  - 表：auth_account（认证账户表）

---

## 十二、系统完整包图（Complete System Package Diagram）

### 12.1 系统完整包图（包含所有功能包和依赖关系）

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        «system»                                             │
│                                        叶片质量追溯系统                                       │
│                              Blade Quality Traceability System                              │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                    ┌─────────────────────┼─────────────────────┐
                    │                     │                     │
                    ▼                     ▼                     ▼
        ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐
        │ «package»       │    │ «package»       │    │ «package»       │
        │ Auth Function   │───▶│ Blade Management│───▶│ Process Input   │
        │                 │«uses│                 │«uses│                 │
        │ ┌────────────┐  │    │ ┌────────────┐  │    │ ┌────────────┐  │
        │ │Frontend UI│  │    │ │Frontend UI│  │    │ │Frontend UI│  │
        │ │login.vue  │  │    │ │blade-list │  │    │ │process-    │  │
        │ └────────────┘  │    │ │blade-     │  │    │ │input.vue  │  │
        │ ┌────────────┐  │    │ │create.vue │  │    │ └────────────┘  │
        │ │Backend API │  │    │ └────────────┘  │    │ ┌────────────┐  │
        │ │auth.js     │  │    │ ┌────────────┐  │    │ │Backend API│  │
        │ └────────────┘  │    │ │Backend API│  │    │ │process.js  │  │
        │ ┌────────────┐  │    │ │blade.js   │  │    │ └────────────┘  │
        │ │Database    │  │    │ └────────────┘  │    │ ┌────────────┐  │
        │ │auth_account│  │    │ ┌────────────┐  │    │ │Database    │  │
        │ │operator_   │  │    │ │Database    │  │    │ │proc_*      │  │
        │ │user        │  │    │ │blade      │  │    │ │process_def │  │
        │ └────────────┘  │    │ │blade_     │  │    │ └────────────┘  │
        └────────┬─────────┘    │ │process_   │  │    └────────┬─────────┘
                 │              │ │state      │  │             │
                 │              │ └────────────┘  │             │
                 │              └────────┬─────────┘             │
                 │                       │                       │
                 │                       │                       │
                 ▼                       ▼                       ▼
        ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐
        │ «package»       │    │ «package»       │    │ «package»       │
        │ QC Function     │    │ Traceability     │    │ System          │
        │                 │    │ Function         │    │ Management      │
        │ ┌────────────┐  │    │                  │    │                 │
        │ │Frontend UI│  │    │ ┌────────────┐  │    │ ┌────────────┐  │
        │ │qc-input   │  │    │ │Frontend UI │  │    │ │Frontend UI │  │
        │ │.vue       │  │    │ │scan.vue    │  │    │ │user-manage │  │
        │ └────────────┘  │    │ │trace-      │  │    │ │statistics  │  │
        │ ┌────────────┐  │    │ │detail.vue  │  │    │ └────────────┘  │
        │ │Backend API │  │    │ └────────────┘  │    │ ┌────────────┐  │
        │ │qc.js       │  │    │ ┌────────────┐  │    │ │Backend API │  │
        │ └────────────┘  │    │ │Backend API │  │    │ │user.js     │  │
        │ ┌────────────┐  │    │ │blade.js    │  │    │ │statistics  │  │
        │ │Database    │  │    │ │(trace)     │  │    │ │.js         │  │
        │ │qc_         │  │    │ └────────────┘  │    │ └────────────┘  │
        │ │inspection  │  │    │ ┌────────────┐  │    │ ┌────────────┐  │
        │ └────────────┘  │    │ │Database    │  │    │ │Database    │  │
        └────────┬─────────┘    │ │(All Tables)│  │    │ │operator_   │  │
                 │              │ └────────────┘  │    │ │user        │  │
                 │              │ ┌────────────┐  │    │ │process_def │  │
                 │              │ │QRCode Gen │  │    │ │auth_account│  │
                 │              │ │generate-qr│  │    │ └────────────┘  │
                 │              │ │.js        │  │    └────────┬─────────┘
                 │              │ └────────────┘  │             │
                 │              └────────┬─────────┘             │
                 │                       │                       │
                 │                       │                       │
                 └───────────────────────┼───────────────────────┘
                                         │
                                         ▼
                            ┌────────────────────────────┐
                            │ «package»                  │
                            │ Statistics Function        │
                            │                            │
                            │ ┌────────────────────────┐ │
                            │ │ Frontend UI            │ │
                            │ │ statistics.vue         │ │
                            │ └────────────────────────┘ │
                            │ ┌────────────────────────┐ │
                            │ │ Backend API            │ │
                            │ │ statistics.js          │ │
                            │ └────────────────────────┘ │
                            │ ┌────────────────────────┐ │
                            │ │ Database               │ │
                            │ │ (All Business Tables)  │ │
                            │ └────────────────────────┘ │
                            └────────────┬───────────────┘
                                         │
                                         │ «uses»
                                         │
        ┌────────────────────────────────┼────────────────────────────────┐
        │                                │                                │
        ▼                                ▼                                ▼
┌──────────────────┐          ┌──────────────────┐          ┌──────────────────┐
│ «package»        │          │ «package»        │          │ «package»        │
│ Common           │          │ Data             │          │ External         │
│ Foundation       │          │ Persistence      │          │                  │
│                  │          │                  │          │                  │
│ ┌──────────────┐ │          │ ┌──────────────┐ │          │ ┌──────────────┐ │
│ │Frontend      │ │          │ │Master Data   │ │          │ │WeChat API    │ │
│ │Common        │ │          │ │blade         │ │          │ │login         │ │
│ │request.js    │ │          │ │operator_user │ │          │ │scanCode      │ │
│ │storage.js    │ │          │ │process_def   │ │          │ └──────────────┘ │
│ │config.js     │ │          │ └──────────────┘ │          │ ┌──────────────┐ │
│ └──────────────┘ │          │ ┌──────────────┐ │          │ │File System   │ │
│ ┌──────────────┐ │          │ │Process Data  │ │          │ │uploads      │ │
│ │Backend       │ │          │ │proc_* (11)   │ │          │ │static       │ │
│ │Common        │ │          │ └──────────────┘ │          │ └──────────────┘ │
│ │middleware/   │ │          │ ┌──────────────┐ │          └──────────────────┘
│ │auth.js       │ │          │ │State Data   │ │
│ │config/       │ │          │ │blade_process│ │
│ │database.js   │ │          │ │_state       │ │
│ └──────────────┘ │          │ └──────────────┘ │
└──────────────────┘          │ ┌──────────────┐ │
                              │ │QC Data       │ │
                              │ │qc_inspection │ │
                              │ └──────────────┘ │
                              │ ┌──────────────┐ │
                              │ │Auth Data     │ │
                              │ │auth_account  │ │
                              │ └──────────────┘ │
                              └──────────────────┘
```

### 12.2 系统包图简化视图（Simplified View）

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    «system»                                         │
│                                    叶片质量追溯系统                                   │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          │
        ┌─────────────────────────────────┼─────────────────────────────────┐
        │                                 │                                 │
        ▼                                 ▼                                 ▼
┌──────────────┐                  ┌──────────────┐                  ┌──────────────┐
│ «package»    │                  │ «package»    │                  │ «package»    │
│ Auth         │───────────────▶ │ Blade        │───────────────▶ │ Process      │
│ Function     │«uses»           │ Management    │«uses»           │ Input        │
└──────────────┘                  └──────────────┘                  └──────────────┘
        │                                 │                                 │
        │                                 │                                 │
        ▼                                 ▼                                 ▼
┌──────────────┐                  ┌──────────────┐                  ┌──────────────┐
│ «package»    │                  │ «package»    │                  │ «package»    │
│ QC           │                  │ Traceability │                  │ System       │
│ Function     │                  │ Function     │                  │ Management   │
└──────┬───────┘                  └──────┬───────┘                  └──────┬───────┘
       │                                 │                                 │
       │                                 │                                 │
       └─────────────────────────────────┼─────────────────────────────────┘
                                         │
                                         ▼
                                ┌──────────────┐
                                │ «package»    │
                                │ Statistics   │
                                │ Function     │
                                └──────┬───────┘
                                       │
                                       │ «uses»
                                       │
        ┌──────────────────────────────┼──────────────────────────────┐
        │                              │                              │
        ▼                              ▼                              ▼
┌──────────────┐              ┌──────────────┐              ┌──────────────┐
│ «package»    │              │ «package»    │              │ «package»    │
│ Common       │              │ Data         │              │ External     │
│ Foundation   │              │ Persistence  │              │              │
└──────────────┘              └──────────────┘              └──────────────┘
```

### 12.3 包图层次结构说明

**第一层：功能包（Function Packages）**
- 认证功能包、叶片管理包、工序录入包、质检功能包、追溯功能包、系统管理包、数据统计包

**第二层：功能包内部结构（Frontend/Backend/Database）**
- 每个功能包包含：前端UI、后端API、数据库表

**第三层：支撑包（Support Packages）**
- 公共基础包：提供公共工具和基础服务
- 数据持久包：提供数据存储服务
- 外部包：提供外部系统接口

### 12.4 功能包详细组件表

| 功能包 | 前端组件 | 后端组件 | 数据库组件 |
|--------|---------|---------|-----------|
| **认证功能包** | login.vue | routes/auth.js<br>middleware/auth.js | auth_account<br>operator_user |
| **叶片管理包** | blade-list.vue<br>blade-create.vue<br>blade-add.vue | routes/blade.js | blade<br>blade_process_state |
| **工序录入包** | process-input.vue | routes/process.js | proc_alloy_preheat<br>proc_stamp_form_cool<br>... (11道工序表)<br>process_def |
| **质检功能包** | qc-input.vue | routes/qc.js | qc_inspection |
| **追溯功能包** | scan.vue<br>trace-detail.vue | routes/blade.js<br>(trace接口)<br>generate-qr.js | 所有业务表 |
| **系统管理包** | user-manage.vue<br>statistics.vue | routes/user.js<br>routes/statistics.js<br>middleware/auth.js | operator_user<br>process_def<br>auth_account |
| **数据统计包** | statistics.vue | routes/statistics.js | 所有业务表 |
| **公共基础包** | request.js<br>storage.js<br>config.js | middleware/auth.js<br>config/database.js | - |
| **数据持久包** | - | - | 所有数据表 |
| **外部包** | - | - | WeChat API<br>File System |

### 12.2 功能包依赖说明

| 功能包 | 依赖的功能包 | 依赖关系说明 |
|--------|------------|------------|
| **认证功能包** | 公共基础包、数据持久包 | 使用公共工具、访问认证数据 |
| **叶片管理包** | 认证功能包、公共基础包、数据持久包 | 需要认证、使用公共工具、访问叶片数据 |
| **工序录入包** | 叶片管理包、认证功能包、公共基础包、数据持久包 | 需要叶片信息、需要认证、使用公共工具、访问工序数据 |
| **质检功能包** | 工序录入包、认证功能包、公共基础包、数据持久包 | 需要工序完成信息、需要认证、使用公共工具、访问质检数据 |
| **追溯功能包** | 所有功能包、公共基础包、数据持久包、外部包 | 需要所有业务数据、使用二维码工具、使用微信API |
| **系统管理包** | 认证功能包、公共基础包、数据持久包 | 需要认证、使用公共工具、访问管理数据 |
| **数据统计包** | 所有业务功能包、公共基础包、数据持久包 | 需要所有业务数据、使用公共工具 |

---

## 十三、功能包详细结构

### 13.1 认证功能包详细结构

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Auth Function Package                    │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (Auth UI)   │      │  (Auth API)  │      │  (Auth Data) │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │ «uses»              │ «uses»              │
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                              ▼
                    ┌──────────────┐
                    │ «package»    │
                    │  Common      │
                    │  Foundation  │
                    └──────────────┘
```

**包含的组件：**
- **Frontend (Auth UI)**：
  - login.vue（登录页面）
  - 依赖：request.js、storage.js、config.js
- **Backend (Auth API)**：
  - routes/auth.js（认证路由）
  - middleware/auth.js（认证中间件）
  - 依赖：database.js、jsonwebtoken
- **Database (Auth Data)**：
  - auth_account（认证账户表）
  - operator_user（人员表）

### 13.2 叶片管理包详细结构

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Blade Management Package                 │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (Blade UI)  │      │  (Blade API) │      │  (Blade Data)│
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │ «uses»              │ «uses»              │
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                              ▼
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Auth        │      │  Common      │      │  State Data  │
│  Function    │      │  Foundation  │      │              │
└──────────────┘      └──────────────┘      └──────────────┘
```

**包含的组件：**
- **Frontend (Blade UI)**：
  - blade-list.vue（叶片列表）
  - blade-create.vue（创建叶片）
  - blade-add.vue（添加叶片）
  - 依赖：request.js、config.js
- **Backend (Blade API)**：
  - routes/blade.js（叶片路由）
  - 功能：创建叶片、查询列表、查询详情、查询追溯
  - 依赖：middleware/auth.js、database.js
- **Database (Blade Data)**：
  - blade（叶片主表）
  - blade_process_state（叶片工序状态表）

### 13.3 工序录入包详细结构

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Process Input Package                    │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (Process UI)│      │  (Process API)│      │  (Process Data)│
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │ «uses»              │ «uses»              │
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                              ▼
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Blade       │      │  Auth        │      │  Common      │
│  Management  │      │  Function    │      │  Foundation  │
└──────────────┘      └──────────────┘      └──────────────┘
```

**包含的组件：**
- **Frontend (Process UI)**：
  - process-input.vue（工序录入页面）
  - 功能：11道工序参数录入、返工处理
  - 依赖：request.js、config.js
- **Backend (Process API)**：
  - routes/process.js（工序路由）
  - 功能：工序记录保存、顺序验证、状态更新、阻塞处理
  - 依赖：middleware/auth.js、database.js
- **Database (Process Data)**：
  - 11道工序表（proc_alloy_preheat等）
  - process_def（工序定义表）
  - blade_process_state（状态表）

### 13.4 质检功能包详细结构

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    QC Function Package                      │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (QC UI)     │      │  (QC API)    │      │  (QC Data)   │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │ «uses»              │ «uses»              │
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                              ▼
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Process     │      │  Blade       │      │  Auth        │
│  Input       │      │  Management  │      │  Function    │
└──────────────┘      └──────────────┘      └──────────────┘
```

**包含的组件：**
- **Frontend (QC UI)**：
  - qc-input.vue（质检录入页面）
  - 依赖：request.js、config.js
- **Backend (QC API)**：
  - routes/qc.js（质检路由）
  - 功能：质检记录保存、叶片状态更新
  - 依赖：middleware/auth.js、database.js
- **Database (QC Data)**：
  - qc_inspection（质检记录表）

### 13.5 追溯功能包详细结构

```
┌─────────────────────────────────────────────────────────────┐
│                    «package»                                │
│                    Traceability Function Package            │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  Frontend    │      │  Backend     │      │  Database    │
│  (Trace UI)  │      │  (Trace API) │      │  (Trace Data)│
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │ «uses»              │ «uses»              │
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                              ▼
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ «package»    │      │ «package»    │      │ «package»    │
│  QRCode      │      │  All         │      │  External    │
│  Generator   │      │  Function    │      │  (WeChat API)│
└──────────────┘      │  Packages    │      └──────────────┘
                      └──────────────┘
```

**包含的组件：**
- **Frontend (Trace UI)**：
  - scan.vue（扫码页面）
  - trace-detail.vue（追溯详情页面）
  - 依赖：request.js、qrcode.js、config.js
- **Backend (Trace API)**：
  - routes/blade.js（追溯路由：GET /api/blade/:id/trace）
  - 功能：追溯信息查询、数据汇总
  - 依赖：database.js
- **Database (Trace Data)**：
  - 所有业务表（blade、工序表、qc_inspection、blade_process_state）
- **QRCode Generator**：
  - generate-qr.js（后端二维码生成）
  - qrcode.js（前端二维码工具）

---

## 十四、功能包职责说明

| 功能包 | 主要职责 | 核心功能 |
|--------|---------|---------|
| **认证功能包** | 用户身份认证和权限管理 | 用户登录、JWT Token生成、权限验证 |
| **叶片管理包** | 叶片信息管理 | 叶片创建、叶片查询、叶片列表、叶片状态管理 |
| **工序录入包** | 工序记录录入和管理 | 11道工序录入、返工处理、状态更新、阻塞处理 |
| **质检功能包** | 最终质检管理 | 质检录入、质检结果判定、叶片状态更新 |
| **追溯功能包** | 生产追溯查询 | 扫码追溯、追溯信息查询、二维码生成和解析 |
| **系统管理包** | 系统配置和管理 | 人员管理、工序定义管理、权限管理 |
| **数据统计包** | 数据统计分析 | 合格率统计、返工率统计、报废率统计 |
| **公共基础包** | 公共工具和基础服务 | 网络请求、存储管理、配置管理、中间件 |
| **数据持久包** | 数据存储和持久化 | 所有业务数据的存储和管理 |

---

## 十五、功能包设计原则

### 15.1 功能内聚

- **单一职责**：每个功能包负责一个明确的业务功能
- **功能完整**：功能包包含该功能所需的前端、后端、数据库组件
- **高内聚**：功能包内组件紧密相关，共同完成功能目标

### 15.2 功能解耦

- **独立功能**：功能包之间相对独立，减少相互依赖
- **接口清晰**：功能包之间通过明确的接口通信
- **低耦合**：功能包依赖关系清晰，避免循环依赖

### 15.3 可扩展性

- **功能扩展**：新增功能可通过新增功能包实现
- **功能复用**：公共基础包提供可复用的工具和服务
- **功能组合**：复杂功能可通过组合多个功能包实现

---

**文档版本：** 3.0  
**最后更新：** 2024-12-27  
**维护者：** 系统架构团队
