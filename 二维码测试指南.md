# 二维码测试指南

## 二维码格式

系统支持两种二维码格式：

### 格式1：完整格式（推荐）
```
B{blade_id}|P{process_order}:{process_record_id},...
```

**示例**：
- `B1|P1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11`
- `B3|P1:1,2:1,3:1` （部分工序）

### 格式2：简单格式（测试用）
```
B{blade_id}
```

**示例**：
- `B1`
- `B3`
- `B8`

## 快速生成二维码

### 方法1：使用在线工具（推荐）

1. **打开生成工具**：
   - 在浏览器中打开 `生成二维码工具.html`
   - 或使用在线二维码生成器：https://cli.im/ 或 https://www.qrcode-monkey.com/

2. **输入内容**：
   - 简单测试：输入 `B3`（叶片ID为3）
   - 完整测试：输入 `B3|P1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1`

3. **生成并保存**：
   - 生成二维码
   - 保存为图片或截图

### 方法2：使用微信小程序

1. 打开微信
2. 搜索"二维码生成器"小程序
3. 输入内容（如：`B3`）
4. 生成二维码
5. 用另一个手机扫描测试

### 方法3：使用命令行工具（Node.js）

```bash
# 安装 qrcode 包
npm install -g qrcode

# 生成二维码（保存为图片）
qrcode "B3" -o qr-b3.png

# 或直接在终端显示
qrcode "B3"
```

## 测试用的二维码内容

### 待质检叶片（推荐测试）
```
B3
```
或完整格式：
```
B3|P1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1
```

### 已完成叶片
```
B1
```

### 加工中叶片
```
B6
```

### 阻塞叶片
```
B8
```

## 测试步骤

### 1. 准备二维码

使用上面的方法生成二维码，内容为 `B3`（叶片ID为3，状态为待质检）

### 2. 在小程序中测试

1. **打开小程序**
2. **登录**（用户名：金秋天，密码：123456）
3. **点击"扫码追溯"**
4. **扫描二维码**
5. **预期结果**：
   - 如果用户是质检员（QC），且叶片状态是 `READY_FOR_QC`
   - 应该**直接跳转到质检录入页面**
   - 否则跳转到追溯详情页面

### 3. 测试不同角色

**作为操作员（OPERATOR）**：
- 扫码后跳转到追溯详情页面
- 只能看到自己操作的工序详情

**作为质检员（QC）**：
- 扫码后，如果叶片状态是 `READY_FOR_QC`，直接进入质检录入
- 否则进入追溯详情页面
- 可以看到所有工序的完整信息

**作为管理员（ADMIN）**：
- 可以看到所有信息
- 可以填写质检报告

## 在线二维码生成器推荐

1. **草料二维码**：https://cli.im/
   - 支持文本、网址等
   - 可以自定义样式

2. **QR Code Monkey**：https://www.qrcode-monkey.com/
   - 支持自定义颜色和Logo
   - 可以下载高清图片

3. **微信小程序**：
   - 搜索"二维码生成器"
   - 输入文本即可生成

## 快速测试二维码

我已经在 `生成二维码工具.html` 中内置了几个快速测试选项：

1. **叶片1** - 已完成（所有工序）
2. **叶片3** - 待质检（推荐测试）
3. **叶片6** - 加工中
4. **叶片8** - 阻塞
5. **简单格式** - 仅叶片ID

点击对应的测试项，会自动生成二维码。

## 注意事项

1. **二维码内容必须准确**：
   - 格式：`B{数字}` 或 `B{数字}|P...`
   - 不要有多余的空格或换行

2. **测试前确保**：
   - 后端服务正在运行
   - 数据库中有对应的叶片数据
   - 已运行 `test_data.sql` 插入测试数据

3. **如果扫码失败**：
   - 检查二维码内容是否正确
   - 检查小程序权限（相机权限）
   - 查看控制台错误信息

## 验证数据

运行测试数据后，可以使用以下叶片ID测试：

- **叶片1-2**：已完成（有质检记录）
- **叶片3-5**：待质检（推荐测试）
- **叶片6-7**：加工中
- **叶片8**：阻塞
- **叶片9**：新建
- **叶片10**：报废

## 下一步

1. 打开 `生成二维码工具.html`
2. 生成测试二维码（推荐：`B3`）
3. 在小程序中测试扫码功能
4. 验证是否能正确跳转到质检录入页面

