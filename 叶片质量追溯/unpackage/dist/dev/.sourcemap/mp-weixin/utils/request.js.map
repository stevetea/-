{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["/**\r\n * 网络请求封装\r\n */\r\n\r\nimport config from './config.js'\r\nimport { USE_MOCK, mockRequest } from './mock.js'\r\n\r\n/**\r\n * 请求封装\r\n */\r\nfunction request(options) {\r\n  // 如果启用 Mock 模式，直接返回 Mock 数据\r\n  if (USE_MOCK) {\r\n    return mockRequest(options)\r\n  }\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    // 获取token\r\n    const token = uni.getStorageSync('token')\r\n    \r\n    // 显示加载提示\r\n    if (options.loading !== false) {\r\n      uni.showLoading({\r\n        title: options.loadingText || '加载中...',\r\n        mask: true\r\n      })\r\n    }\r\n    \r\n    uni.request({\r\n      url: config.API_BASE_URL + options.url,\r\n      method: options.method || 'GET',\r\n      data: options.data || {},\r\n      header: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': token ? `Bearer ${token}` : '',\r\n        ...options.header\r\n      },\r\n      success: (res) => {\r\n        uni.hideLoading()\r\n        \r\n        // 处理不同的HTTP状态码\r\n        if (res.statusCode === 200) {\r\n          if (res.data && (res.data.code === 200 || res.data.success)) {\r\n            resolve(res.data)\r\n          } else if (res.data && res.data.code === 401) {\r\n            // token过期，跳转登录\r\n            uni.removeStorageSync('token')\r\n            uni.removeStorageSync('userInfo')\r\n            uni.reLaunch({\r\n              url: '/pages/login/login'\r\n            })\r\n            reject(res.data)\r\n          } else {\r\n            const errorMsg = res.data?.message || '请求失败'\r\n            console.error('请求失败:', res.data)\r\n            uni.showToast({\r\n              title: errorMsg,\r\n              icon: 'none',\r\n              duration: 2000\r\n            })\r\n            reject(res.data || res)\r\n          }\r\n        } else if (res.statusCode === 401) {\r\n          // 未授权\r\n          uni.removeStorageSync('token')\r\n          uni.removeStorageSync('userInfo')\r\n          uni.reLaunch({\r\n            url: '/pages/login/login'\r\n          })\r\n          reject(res.data)\r\n        } else if (res.statusCode === 404) {\r\n          // 接口不存在\r\n          console.error('接口不存在:', options.url)\r\n          uni.showToast({\r\n            title: '接口不存在，请检查后端服务',\r\n            icon: 'none',\r\n            duration: 2000\r\n          })\r\n          reject(res)\r\n        } else {\r\n          uni.hideLoading()\r\n          const errorMsg = res.data?.message || `网络错误 (${res.statusCode})`\r\n          console.error('请求错误:', res)\r\n          uni.showToast({\r\n            title: errorMsg,\r\n            icon: 'none',\r\n            duration: 2000\r\n          })\r\n          reject(res)\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        uni.hideLoading()\r\n        console.error('网络请求失败:', err)\r\n        \r\n        let errorMsg = '网络请求失败'\r\n        if (err.errMsg) {\r\n          if (err.errMsg.includes('url not in domain list')) {\r\n            errorMsg = '域名未配置，请在微信开发者工具中关闭域名校验'\r\n          } else if (err.errMsg.includes('timeout')) {\r\n            errorMsg = '请求超时，请检查网络连接'\r\n          } else if (err.errMsg.includes('fail')) {\r\n            errorMsg = '无法连接到服务器，请确认后端服务是否运行'\r\n          }\r\n        }\r\n        \r\n        uni.showToast({\r\n          title: errorMsg,\r\n          icon: 'none',\r\n          duration: 3000\r\n        })\r\n        reject(err)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * GET请求\r\n */\r\nexport function get(url, data, options = {}) {\r\n  return request({\r\n    url,\r\n    method: 'GET',\r\n    data,\r\n    ...options\r\n  })\r\n}\r\n\r\n/**\r\n * POST请求\r\n */\r\nexport function post(url, data, options = {}) {\r\n  return request({\r\n    url,\r\n    method: 'POST',\r\n    data,\r\n    ...options\r\n  })\r\n}\r\n\r\n/**\r\n * PUT请求\r\n */\r\nexport function put(url, data, options = {}) {\r\n  return request({\r\n    url,\r\n    method: 'PUT',\r\n    data,\r\n    ...options\r\n  })\r\n}\r\n\r\n/**\r\n * DELETE请求\r\n */\r\nexport function del(url, data, options = {}) {\r\n  return request({\r\n    url,\r\n    method: 'DELETE',\r\n    data,\r\n    ...options\r\n  })\r\n}\r\n\r\nexport default {\r\n  request,\r\n  get,\r\n  post,\r\n  put,\r\n  delete: del\r\n}\r\n\r\n"],"names":["uni","config"],"mappings":"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"}