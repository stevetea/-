{"version":3,"file":"statistics.js","sources":["pages/statistics/statistics.vue","F:/Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3RhdGlzdGljcy9zdGF0aXN0aWNzLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"statistics-container\">\r\n    <view class=\"page-title\">数据统计</view>\r\n\r\n    <!-- 叶片统计 -->\r\n    <view class=\"stat-card\">\r\n      <view class=\"card-title\">叶片统计</view>\r\n      <view class=\"stat-grid\">\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.blade?.total || 0 }}</text>\r\n          <text class=\"stat-label\">总叶片数</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.blade?.new_count || 0 }}</text>\r\n          <text class=\"stat-label\">新建</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.blade?.in_process_count || 0 }}</text>\r\n          <text class=\"stat-label\">加工中</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.blade?.blocked_count || 0 }}</text>\r\n          <text class=\"stat-label\">阻塞</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.blade?.ready_for_qc_count || 0 }}</text>\r\n          <text class=\"stat-label\">待质检</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.blade?.completed_count || 0 }}</text>\r\n          <text class=\"stat-label\">已完成</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.blade?.scrapped_count || 0 }}</text>\r\n          <text class=\"stat-label\">报废</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 用户统计 -->\r\n    <view class=\"stat-card\">\r\n      <view class=\"card-title\">用户统计</view>\r\n      <view class=\"stat-grid\">\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.user?.total || 0 }}</text>\r\n          <text class=\"stat-label\">总用户数</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.user?.operator_count || 0 }}</text>\r\n          <text class=\"stat-label\">操作员</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.user?.qc_count || 0 }}</text>\r\n          <text class=\"stat-label\">质检员</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.user?.admin_count || 0 }}</text>\r\n          <text class=\"stat-label\">管理员</text>\r\n        </view>\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.user?.active_count || 0 }}</text>\r\n          <text class=\"stat-label\">启用中</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 工序统计 -->\r\n    <view class=\"stat-card\">\r\n      <view class=\"card-title\">工序统计（最近30天）</view>\r\n      <view class=\"stat-grid\">\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.process?.total_records || 0 }}</text>\r\n          <text class=\"stat-label\">总记录数</text>\r\n        </view>\r\n        <view class=\"stat-item success\">\r\n          <text class=\"stat-value\">{{ statistics.process?.success_count || 0 }}</text>\r\n          <text class=\"stat-label\">成功</text>\r\n        </view>\r\n        <view class=\"stat-item danger\">\r\n          <text class=\"stat-value\">{{ statistics.process?.fail_count || 0 }}</text>\r\n          <text class=\"stat-label\">失败</text>\r\n        </view>\r\n        <view class=\"stat-item\" v-if=\"statistics.process?.total_records > 0\">\r\n          <text class=\"stat-value\">\r\n            {{ Math.round((statistics.process.success_count / statistics.process.total_records) * 100) }}%\r\n          </text>\r\n          <text class=\"stat-label\">成功率</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 质检统计 -->\r\n    <view class=\"stat-card\">\r\n      <view class=\"card-title\">质检统计</view>\r\n      <view class=\"stat-grid\">\r\n        <view class=\"stat-item\">\r\n          <text class=\"stat-value\">{{ statistics.qc?.total || 0 }}</text>\r\n          <text class=\"stat-label\">总质检数</text>\r\n        </view>\r\n        <view class=\"stat-item success\">\r\n          <text class=\"stat-value\">{{ statistics.qc?.pass_count || 0 }}</text>\r\n          <text class=\"stat-label\">通过</text>\r\n        </view>\r\n        <view class=\"stat-item danger\">\r\n          <text class=\"stat-value\">{{ statistics.qc?.fail_count || 0 }}</text>\r\n          <text class=\"stat-label\">不通过</text>\r\n        </view>\r\n        <view class=\"stat-item\" v-if=\"statistics.qc?.total > 0\">\r\n          <text class=\"stat-value\">\r\n            {{ Math.round((statistics.qc.pass_count / statistics.qc.total) * 100) }}%\r\n          </text>\r\n          <text class=\"stat-label\">通过率</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 最近7天叶片创建趋势 -->\r\n    <view class=\"stat-card\" v-if=\"statistics.dailyBlade && statistics.dailyBlade.length > 0\">\r\n      <view class=\"card-title\">最近7天叶片创建趋势</view>\r\n      <view class=\"trend-list\">\r\n        <view \r\n          class=\"trend-item\" \r\n          v-for=\"(item, index) in statistics.dailyBlade\" \r\n          :key=\"index\"\r\n        >\r\n          <view class=\"trend-date\">{{ formatDate(item.date) }}</view>\r\n          <view class=\"trend-bar-wrapper\">\r\n            <view \r\n              class=\"trend-bar\" \r\n              :style=\"{ width: getBarWidth(item.count) + '%' }\"\r\n            ></view>\r\n            <text class=\"trend-value\">{{ item.count }}</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"empty-tip\" v-if=\"!loading && Object.keys(statistics).length === 0\">\r\n      <text>暂无数据</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { get } from '@/utils/request.js'\r\nimport storage from '@/utils/storage.js'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      statistics: {},\r\n      loading: false,\r\n      maxDailyCount: 0\r\n    }\r\n  },\r\n  onLoad() {\r\n    // 检查权限\r\n    const userInfo = storage.getUserInfo()\r\n    if (!userInfo || userInfo.role !== 'ADMIN') {\r\n      uni.showToast({\r\n        title: '无权限访问',\r\n        icon: 'none'\r\n      })\r\n      setTimeout(() => {\r\n        uni.navigateBack()\r\n      }, 1500)\r\n      return\r\n    }\r\n    \r\n    this.loadStatistics()\r\n  },\r\n  onPullDownRefresh() {\r\n    this.loadStatistics()\r\n  },\r\n  methods: {\r\n    async loadStatistics() {\r\n      this.loading = true\r\n      try {\r\n        const res = await get('/statistics')\r\n        if (res && res.data) {\r\n          this.statistics = res.data\r\n          \r\n          // 计算最大日创建数，用于显示趋势图\r\n          if (res.data.dailyBlade && res.data.dailyBlade.length > 0) {\r\n            this.maxDailyCount = Math.max(...res.data.dailyBlade.map(item => item.count))\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('加载统计数据失败:', error)\r\n        uni.showToast({\r\n          title: '加载失败',\r\n          icon: 'none'\r\n        })\r\n      } finally {\r\n        this.loading = false\r\n        uni.stopPullDownRefresh()\r\n      }\r\n    },\r\n    \r\n    formatDate(dateStr) {\r\n      if (!dateStr) return ''\r\n      const date = new Date(dateStr)\r\n      const month = String(date.getMonth() + 1).padStart(2, '0')\r\n      const day = String(date.getDate()).padStart(2, '0')\r\n      return `${month}-${day}`\r\n    },\r\n    \r\n    getBarWidth(count) {\r\n      if (!this.maxDailyCount || this.maxDailyCount === 0) return 0\r\n      return Math.min((count / this.maxDailyCount) * 100, 100)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.statistics-container {\r\n  min-height: 100vh;\r\n  background: #FFFFFF;\r\n  padding: 20rpx;\r\n}\r\n\r\n.page-title {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n  text-align: center;\r\n}\r\n\r\n.stat-card {\r\n  background: #ffffff;\r\n  border-radius: 20rpx;\r\n  padding: 30rpx;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.card-title {\r\n  font-size: 30rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.stat-grid {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 20rpx;\r\n}\r\n\r\n.stat-item {\r\n  flex: 1;\r\n  min-width: calc(50% - 10rpx);\r\n  text-align: center;\r\n  padding: 20rpx;\r\n  background: #f8f9fa;\r\n  border-radius: 15rpx;\r\n}\r\n\r\n.stat-item.success {\r\n  background: #e8f5e9;\r\n}\r\n\r\n.stat-item.danger {\r\n  background: #ffebee;\r\n}\r\n\r\n.stat-value {\r\n  display: block;\r\n  font-size: 48rpx;\r\n  font-weight: bold;\r\n  color: #667eea;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.stat-item.success .stat-value {\r\n  color: #4caf50;\r\n}\r\n\r\n.stat-item.danger .stat-value {\r\n  color: #f44336;\r\n}\r\n\r\n.stat-label {\r\n  display: block;\r\n  font-size: 24rpx;\r\n  color: #666;\r\n}\r\n\r\n.trend-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20rpx;\r\n}\r\n\r\n.trend-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 20rpx;\r\n}\r\n\r\n.trend-date {\r\n  width: 120rpx;\r\n  font-size: 24rpx;\r\n  color: #666;\r\n}\r\n\r\n.trend-bar-wrapper {\r\n  flex: 1;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 15rpx;\r\n  position: relative;\r\n  height: 40rpx;\r\n  background: #f5f5f5;\r\n  border-radius: 20rpx;\r\n  overflow: hidden;\r\n}\r\n\r\n.trend-bar {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  height: 100%;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  border-radius: 20rpx;\r\n  transition: width 0.3s ease;\r\n}\r\n\r\n.trend-value {\r\n  position: relative;\r\n  z-index: 1;\r\n  font-size: 24rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-left: 10rpx;\r\n}\r\n\r\n.empty-tip {\r\n  text-align: center;\r\n  padding: 100rpx;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n</style>\r\n\r\n","import MiniProgramPage from 'D:/yepian32323232/yepian/叶片质量追溯/pages/statistics/statistics.vue'\nwx.createPage(MiniProgramPage)"],"names":["storage","uni","get"],"mappings":";;;;AAmJA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,YAAY,CAAE;AAAA,MACd,SAAS;AAAA,MACT,eAAe;AAAA,IACjB;AAAA,EACD;AAAA,EACD,SAAS;AAEP,UAAM,WAAWA,cAAO,QAAC,YAAY;AACrC,QAAI,CAAC,YAAY,SAAS,SAAS,SAAS;AAC1CC,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,OACP;AACD,iBAAW,MAAM;AACfA,sBAAAA,MAAI,aAAa;AAAA,MAClB,GAAE,IAAI;AACP;AAAA,IACF;AAEA,SAAK,eAAe;AAAA,EACrB;AAAA,EACD,oBAAoB;AAClB,SAAK,eAAe;AAAA,EACrB;AAAA,EACD,SAAS;AAAA,IACP,MAAM,iBAAiB;AACrB,WAAK,UAAU;AACf,UAAI;AACF,cAAM,MAAM,MAAMC,cAAG,IAAC,aAAa;AACnC,YAAI,OAAO,IAAI,MAAM;AACnB,eAAK,aAAa,IAAI;AAGtB,cAAI,IAAI,KAAK,cAAc,IAAI,KAAK,WAAW,SAAS,GAAG;AACzD,iBAAK,gBAAgB,KAAK,IAAI,GAAG,IAAI,KAAK,WAAW,IAAI,UAAQ,KAAK,KAAK,CAAC;AAAA,UAC9E;AAAA,QACF;AAAA,MACA,SAAO,OAAO;AACdD,sBAAAA,MAAc,MAAA,SAAA,0CAAA,aAAa,KAAK;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,SACP;AAAA,MACH,UAAU;AACR,aAAK,UAAU;AACfA,sBAAAA,MAAI,oBAAoB;AAAA,MAC1B;AAAA,IACD;AAAA,IAED,WAAW,SAAS;AAClB,UAAI,CAAC;AAAS,eAAO;AACrB,YAAM,OAAO,IAAI,KAAK,OAAO;AAC7B,YAAM,QAAQ,OAAO,KAAK,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG;AACzD,YAAM,MAAM,OAAO,KAAK,QAAS,CAAA,EAAE,SAAS,GAAG,GAAG;AAClD,aAAO,GAAG,KAAK,IAAI,GAAG;AAAA,IACvB;AAAA,IAED,YAAY,OAAO;AACjB,UAAI,CAAC,KAAK,iBAAiB,KAAK,kBAAkB;AAAG,eAAO;AAC5D,aAAO,KAAK,IAAK,QAAQ,KAAK,gBAAiB,KAAK,GAAG;AAAA,IACzD;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnNA,GAAG,WAAW,eAAe;"}