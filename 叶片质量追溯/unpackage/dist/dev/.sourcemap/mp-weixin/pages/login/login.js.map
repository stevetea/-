{"version":3,"file":"login.js","sources":["pages/login/login.vue","F:/Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n  <view class=\"login-container\">\r\n    <view class=\"logo-section\">\r\n      <image class=\"logo\" src=\"/static/logo.png\" mode=\"aspectFit\"></image>\r\n      <text class=\"app-name\">叶片质量追溯系统</text>\r\n    </view>\r\n    \r\n    <view class=\"login-form\">\r\n      <view class=\"form-item\">\r\n        <text class=\"label\">工号/姓名</text>\r\n        <input \r\n          class=\"input\" \r\n          v-model=\"form.operatorName\" \r\n          placeholder=\"请输入工号或姓名\"\r\n          maxlength=\"64\"\r\n        />\r\n      </view>\r\n      \r\n      <view class=\"form-item\">\r\n        <text class=\"label\">密码</text>\r\n        <input \r\n          class=\"input\" \r\n          v-model=\"form.password\" \r\n          type=\"password\"\r\n          placeholder=\"请输入密码\"\r\n          maxlength=\"32\"\r\n        />\r\n      </view>\r\n      \r\n      <button class=\"login-btn\" @click=\"handleLogin\" :loading=\"loading\">\r\n        登录\r\n      </button>\r\n    </view>\r\n    \r\n    <view class=\"tips\">\r\n      <text>提示：首次登录请使用微信授权</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { post } from '@/utils/request.js'\r\nimport storage from '@/utils/storage.js'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      form: {\r\n        operatorName: '',\r\n        password: ''\r\n      },\r\n      loading: false\r\n    }\r\n  },\r\n  onLoad() {\r\n    // 检查是否已登录\r\n    const token = storage.getToken()\r\n    const userInfo = storage.getUserInfo()\r\n    if (token && userInfo) {\r\n      this.redirectToHome(userInfo)\r\n    }\r\n  },\r\n  methods: {\r\n    async handleLogin() {\r\n      if (!this.form.operatorName) {\r\n        uni.showToast({\r\n          title: '请输入工号或姓名',\r\n          icon: 'none'\r\n        })\r\n        return\r\n      }\r\n      \r\n      if (!this.form.password) {\r\n        uni.showToast({\r\n          title: '请输入密码（默认密码：123456）',\r\n          icon: 'none',\r\n          duration: 2000\r\n        })\r\n        return\r\n      }\r\n      \r\n      this.loading = true\r\n      \r\n      try {\r\n        // 先尝试微信登录\r\n        const loginRes = await uni.login({\r\n          provider: 'weixin'\r\n        })\r\n        \r\n        // 调用登录接口\r\n        const res = await post('/auth/login', {\r\n          code: loginRes.code,\r\n          operatorName: this.form.operatorName,\r\n          password: this.form.password\r\n        })\r\n        \r\n        if (res.data) {\r\n          // 保存token和用户信息\r\n          storage.setToken(res.data.token)\r\n          storage.setUserInfo(res.data.userInfo)\r\n          \r\n          uni.showToast({\r\n            title: '登录成功',\r\n            icon: 'success'\r\n          })\r\n          \r\n          // 跳转到首页\r\n          setTimeout(() => {\r\n            this.redirectToHome(res.data.userInfo)\r\n          }, 500)\r\n        }\r\n      } catch (error) {\r\n        console.error('登录失败:', error)\r\n        uni.showToast({\r\n          title: error.message || '登录失败，请检查账号密码',\r\n          icon: 'none',\r\n          duration: 2000\r\n        })\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    \r\n    redirectToHome(userInfo) {\r\n      // 根据角色跳转到不同页面\r\n      uni.reLaunch({\r\n        url: '/pages/index/index'\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.login-container {\r\n  min-height: 100vh;\r\n  background: linear-gradient(135deg, #FFE4E1 0%, #FFB6C1 100%);\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 60rpx 40rpx;\r\n}\r\n\r\n.logo-section {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-bottom: 100rpx;\r\n  animation: fadeInDown 0.8s ease;\r\n}\r\n\r\n@keyframes fadeInDown {\r\n  from {\r\n    opacity: 0;\r\n    transform: translateY(-30rpx);\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\n.logo {\r\n  width: 150rpx;\r\n  height: 150rpx;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.app-name {\r\n  font-size: 40rpx;\r\n  font-weight: bold;\r\n  color: #ffffff;\r\n}\r\n\r\n.login-form {\r\n  width: 100%;\r\n  max-width: 600rpx;\r\n  background: #ffffff;\r\n  border-radius: 24rpx;\r\n  padding: 60rpx 40rpx;\r\n  box-shadow: 0 20rpx 60rpx rgba(0, 0, 0, 0.15);\r\n  animation: fadeInUp 0.8s ease 0.2s both;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.login-form::before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  height: 6rpx;\r\n  background: linear-gradient(90deg, #FFB6C1, #FFB6C1);\r\n}\r\n\r\n@keyframes fadeInUp {\r\n  from {\r\n    opacity: 0;\r\n    transform: translateY(30rpx);\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\n.form-item {\r\n  margin-bottom: 40rpx;\r\n}\r\n\r\n.label {\r\n  display: block;\r\n  font-size: 28rpx;\r\n  color: #333333;\r\n  margin-bottom: 20rpx;\r\n  font-weight: 500;\r\n}\r\n\r\n.input {\r\n  width: 100%;\r\n  height: 88rpx;\r\n  background: #f8f9fa;\r\n  border-radius: 12rpx;\r\n  padding: 0 30rpx;\r\n  font-size: 28rpx;\r\n  box-sizing: border-box;\r\n  border: none;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.input:focus {\r\n  background: #ffffff;\r\n  border: none;\r\n  box-shadow: none;\r\n}\r\n\r\n.login-btn {\r\n  width: 100%;\r\n  height: 88rpx;\r\n  background: linear-gradient(135deg, #FFB6C1 0%, #FFB6C1 100%);\r\n  color: #ffffff;\r\n  border-radius: 12rpx;\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  margin-top: 40rpx;\r\n  border: none;\r\n  box-shadow: 0 8rpx 20rpx rgba(102, 126, 234, 0.3);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: all 0.3s ease;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.login-btn::before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  width: 0;\r\n  height: 0;\r\n  border-radius: 50%;\r\n  background: rgba(255, 255, 255, 0.3);\r\n  transform: translate(-50%, -50%);\r\n  transition: width 0.6s, height 0.6s;\r\n}\r\n\r\n.login-btn:active::before {\r\n  width: 300rpx;\r\n  height: 300rpx;\r\n}\r\n\r\n.login-btn:active {\r\n  transform: scale(0.98);\r\n  box-shadow: 0 4rpx 12rpx rgba(102, 126, 234, 0.4);\r\n}\r\n\r\n.login-btn::after {\r\n  border: none;\r\n}\r\n\r\n.tips {\r\n  margin-top: 40rpx;\r\n  text-align: center;\r\n}\r\n\r\n.tips text {\r\n  font-size: 24rpx;\r\n  color: rgba(255, 255, 255, 0.8);\r\n}\r\n</style>\r\n\r\n","import MiniProgramPage from 'D:/yepian3/yepian/叶片质量追溯/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["storage","uni","post"],"mappings":";;;;;AA4CA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,MAAM;AAAA,QACJ,cAAc;AAAA,QACd,UAAU;AAAA,MACX;AAAA,MACD,SAAS;AAAA,IACX;AAAA,EACD;AAAA,EACD,SAAS;AAEP,UAAM,QAAQA,cAAO,QAAC,SAAS;AAC/B,UAAM,WAAWA,cAAO,QAAC,YAAY;AACrC,QAAI,SAAS,UAAU;AACrB,WAAK,eAAe,QAAQ;AAAA,IAC9B;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,MAAM,cAAc;AAClB,UAAI,CAAC,KAAK,KAAK,cAAc;AAC3BC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,SACP;AACD;AAAA,MACF;AAEA,UAAI,CAAC,KAAK,KAAK,UAAU;AACvBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,SACX;AACD;AAAA,MACF;AAEA,WAAK,UAAU;AAEf,UAAI;AAEF,cAAM,WAAW,MAAMA,cAAG,MAAC,MAAM;AAAA,UAC/B,UAAU;AAAA,SACX;AAGD,cAAM,MAAM,MAAMC,cAAI,KAAC,eAAe;AAAA,UACpC,MAAM,SAAS;AAAA,UACf,cAAc,KAAK,KAAK;AAAA,UACxB,UAAU,KAAK,KAAK;AAAA,SACrB;AAED,YAAI,IAAI,MAAM;AAEZF,wBAAAA,QAAQ,SAAS,IAAI,KAAK,KAAK;AAC/BA,wBAAAA,QAAQ,YAAY,IAAI,KAAK,QAAQ;AAErCC,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,WACP;AAGD,qBAAW,MAAM;AACf,iBAAK,eAAe,IAAI,KAAK,QAAQ;AAAA,UACtC,GAAE,GAAG;AAAA,QACR;AAAA,MACA,SAAO,OAAO;AACdA,sBAAAA,MAAc,MAAA,SAAA,gCAAA,SAAS,KAAK;AAC5BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,MAAM,WAAW;AAAA,UACxB,MAAM;AAAA,UACN,UAAU;AAAA,SACX;AAAA,MACH,UAAU;AACR,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA,IAED,eAAe,UAAU;AAEvBA,oBAAAA,MAAI,SAAS;AAAA,QACX,KAAK;AAAA,OACN;AAAA,IACH;AAAA,EACF;AACF;;;;;;;;;;;;;ACjIA,GAAG,WAAW,eAAe;"}