{"version":3,"file":"user-manage.js","sources":["pages/user-manage/user-manage.vue","F:/Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci1tYW5hZ2UvdXNlci1tYW5hZ2UudnVl"],"sourcesContent":["<template>\r\n  <view class=\"user-manage-container\">\r\n    <view class=\"header\">\r\n      <view class=\"header-title\">人员管理</view>\r\n      <button class=\"add-btn\" @click=\"showAddModal\">+ 添加用户</button>\r\n    </view>\r\n\r\n    <!-- 用户列表 -->\r\n    <view class=\"user-list\">\r\n      <view \r\n        class=\"user-item\" \r\n        v-for=\"(user, index) in userList\" \r\n        :key=\"index\"\r\n      >\r\n        <view class=\"user-info\">\r\n          <view class=\"user-name\">{{ user.operator_name }}</view>\r\n          <view class=\"user-meta\">\r\n            <text class=\"role-badge\" :class=\"getRoleClass(user.role)\">\r\n              {{ getRoleText(user.role) }}\r\n            </text>\r\n            <text class=\"status-badge\" :class=\"user.is_active ? 'active' : 'inactive'\">\r\n              {{ user.is_active ? '启用' : '停用' }}\r\n            </text>\r\n          </view>\r\n        </view>\r\n        <view class=\"user-actions\">\r\n          <text class=\"action-btn\" @click=\"editUser(user)\">编辑</text>\r\n          <text \r\n            class=\"action-btn danger\" \r\n            @click=\"toggleUserStatus(user)\"\r\n            v-if=\"user.is_active\"\r\n          >\r\n            停用\r\n          </text>\r\n          <text \r\n            class=\"action-btn\" \r\n            @click=\"toggleUserStatus(user)\"\r\n            v-else\r\n          >\r\n            启用\r\n          </text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"empty-tip\" v-if=\"userList.length === 0 && !loading\">\r\n      <text>暂无用户</text>\r\n    </view>\r\n\r\n    <!-- 添加/编辑用户弹窗 -->\r\n    <view class=\"modal\" v-if=\"showModal\" @click=\"closeModal\">\r\n      <view class=\"modal-content\" @click.stop>\r\n        <view class=\"modal-header\">\r\n          <text class=\"modal-title\">{{ editingUser ? '编辑用户' : '添加用户' }}</text>\r\n          <text class=\"modal-close\" @click=\"closeModal\">×</text>\r\n        </view>\r\n        <view class=\"modal-body\">\r\n          <view class=\"form-item\">\r\n            <text class=\"form-label\">工号/姓名 *</text>\r\n            <input \r\n              class=\"form-input\" \r\n              v-model=\"form.operator_name\" \r\n              placeholder=\"请输入工号或姓名\"\r\n              maxlength=\"50\"\r\n            />\r\n          </view>\r\n          <view class=\"form-item\">\r\n            <text class=\"form-label\">角色 *</text>\r\n            <picker \r\n              mode=\"selector\" \r\n              :range=\"roleOptions\" \r\n              range-key=\"label\"\r\n              :value=\"roleIndex\"\r\n              @change=\"onRoleChange\"\r\n            >\r\n              <view class=\"form-picker\">\r\n                {{ roleOptions[roleIndex].label }}\r\n              </view>\r\n            </picker>\r\n          </view>\r\n          <view class=\"form-item\">\r\n            <text class=\"form-label\">密码{{ editingUser ? '（留空不修改）' : '（留空默认123456）' }}</text>\r\n            <input \r\n              class=\"form-input\" \r\n              v-model=\"form.password\" \r\n              type=\"password\"\r\n              :placeholder=\"editingUser ? '留空则不修改密码' : '留空则使用默认密码123456'\"\r\n              maxlength=\"50\"\r\n            />\r\n          </view>\r\n          <view class=\"form-item\" v-if=\"editingUser\">\r\n            <text class=\"form-label\">状态</text>\r\n            <view class=\"switch-group\">\r\n              <text \r\n                class=\"switch-item\" \r\n                :class=\"{ active: form.is_active }\"\r\n                @click=\"form.is_active = true\"\r\n              >\r\n                启用\r\n              </text>\r\n              <text \r\n                class=\"switch-item\" \r\n                :class=\"{ active: !form.is_active }\"\r\n                @click=\"form.is_active = false\"\r\n              >\r\n                停用\r\n              </text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n        <view class=\"modal-footer\">\r\n          <button class=\"modal-btn cancel\" @click=\"closeModal\">取消</button>\r\n          <button class=\"modal-btn confirm\" @click=\"handleSubmit\" :loading=\"submitting\">\r\n            确定\r\n          </button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { get, post, put, del as deleteUser } from '@/utils/request.js'\r\nimport storage from '@/utils/storage.js'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      userList: [],\r\n      loading: false,\r\n      showModal: false,\r\n      editingUser: null,\r\n      submitting: false,\r\n      form: {\r\n        operator_name: '',\r\n        role: 'OPERATOR',\r\n        password: '',\r\n        is_active: 1\r\n      },\r\n      roleOptions: [\r\n        { value: 'OPERATOR', label: '操作员' },\r\n        { value: 'QC', label: '质检员' },\r\n        { value: 'ADMIN', label: '管理员' }\r\n      ],\r\n      roleIndex: 0\r\n    }\r\n  },\r\n  onLoad() {\r\n    // 检查权限\r\n    const userInfo = storage.getUserInfo()\r\n    if (!userInfo || userInfo.role !== 'ADMIN') {\r\n      uni.showToast({\r\n        title: '无权限访问',\r\n        icon: 'none'\r\n      })\r\n      setTimeout(() => {\r\n        uni.navigateBack()\r\n      }, 1500)\r\n      return\r\n    }\r\n    \r\n    this.loadUserList()\r\n  },\r\n  methods: {\r\n    async loadUserList() {\r\n      this.loading = true\r\n      try {\r\n        const res = await get('/user/list')\r\n        if (res && res.data) {\r\n          this.userList = res.data.list || []\r\n        }\r\n      } catch (error) {\r\n        console.error('加载用户列表失败:', error)\r\n        uni.showToast({\r\n          title: '加载失败',\r\n          icon: 'none'\r\n        })\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    \r\n    showAddModal() {\r\n      this.editingUser = null\r\n      this.form = {\r\n        operator_name: '',\r\n        role: 'OPERATOR',\r\n        password: '',\r\n        is_active: 1\r\n      }\r\n      this.roleIndex = 0\r\n      this.showModal = true\r\n    },\r\n    \r\n    editUser(user) {\r\n      this.editingUser = user\r\n      this.form = {\r\n        operator_name: user.operator_name,\r\n        role: user.role,\r\n        password: '',\r\n        is_active: user.is_active\r\n      }\r\n      this.roleIndex = this.roleOptions.findIndex(r => r.value === user.role)\r\n      if (this.roleIndex === -1) this.roleIndex = 0\r\n      this.showModal = true\r\n    },\r\n    \r\n    closeModal() {\r\n      this.showModal = false\r\n      this.editingUser = null\r\n    },\r\n    \r\n    onRoleChange(e) {\r\n      this.roleIndex = parseInt(e.detail.value)\r\n      this.form.role = this.roleOptions[this.roleIndex].value\r\n    },\r\n    \r\n    async handleSubmit() {\r\n      if (!this.form.operator_name || !this.form.operator_name.trim()) {\r\n        uni.showToast({\r\n          title: '请输入工号或姓名',\r\n          icon: 'none'\r\n        })\r\n        return\r\n      }\r\n      \r\n      this.submitting = true\r\n      try {\r\n        if (this.editingUser) {\r\n          // 更新用户\r\n          await put(`/user/${this.editingUser.operator_id}`, this.form)\r\n          uni.showToast({\r\n            title: '更新成功',\r\n            icon: 'success'\r\n          })\r\n        } else {\r\n          // 创建用户\r\n          await post('/user', this.form)\r\n          uni.showToast({\r\n            title: '创建成功',\r\n            icon: 'success'\r\n          })\r\n        }\r\n        \r\n        this.closeModal()\r\n        this.loadUserList()\r\n      } catch (error) {\r\n        console.error('操作失败:', error)\r\n        const errorMsg = error.message || error.data?.message || '操作失败'\r\n        uni.showToast({\r\n          title: errorMsg,\r\n          icon: 'none',\r\n          duration: 2000\r\n        })\r\n      } finally {\r\n        this.submitting = false\r\n      }\r\n    },\r\n    \r\n    async toggleUserStatus(user) {\r\n      uni.showModal({\r\n        title: '确认',\r\n        content: `确定要${user.is_active ? '停用' : '启用'}该用户吗？`,\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            try {\r\n              await put(`/user/${user.operator_id}`, {\r\n                is_active: user.is_active ? 0 : 1\r\n              })\r\n              uni.showToast({\r\n                title: '操作成功',\r\n                icon: 'success'\r\n              })\r\n              this.loadUserList()\r\n            } catch (error) {\r\n              console.error('操作失败:', error)\r\n              uni.showToast({\r\n                title: '操作失败',\r\n                icon: 'none'\r\n              })\r\n            }\r\n          }\r\n        }\r\n      })\r\n    },\r\n    \r\n    getRoleText(role) {\r\n      const roleMap = {\r\n        'OPERATOR': '操作员',\r\n        'QC': '质检员',\r\n        'ADMIN': '管理员'\r\n      }\r\n      return roleMap[role] || role\r\n    },\r\n    \r\n    getRoleClass(role) {\r\n      const classMap = {\r\n        'OPERATOR': 'role-operator',\r\n        'QC': 'role-qc',\r\n        'ADMIN': 'role-admin'\r\n      }\r\n      return classMap[role] || ''\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.user-manage-container {\r\n  min-height: 100vh;\r\n  background: #FFFFFF;\r\n  padding: 20rpx;\r\n}\r\n\r\n.header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.header-title {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.add-btn {\r\n  padding: 12rpx 24rpx;\r\n  background: linear-gradient(135deg, #FFB6C1 0%, #FFB6C1 100%);\r\n  color: #ffffff;\r\n  border-radius: 20rpx;\r\n  font-size: 26rpx;\r\n  border: none;\r\n}\r\n\r\n.add-btn::after {\r\n  border: none;\r\n}\r\n\r\n.user-list {\r\n  background: #ffffff;\r\n  border-radius: 20rpx;\r\n  overflow: hidden;\r\n}\r\n\r\n.user-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 30rpx;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.user-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.user-info {\r\n  flex: 1;\r\n}\r\n\r\n.user-name {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.user-meta {\r\n  display: flex;\r\n  gap: 15rpx;\r\n}\r\n\r\n.role-badge {\r\n  padding: 4rpx 12rpx;\r\n  border-radius: 12rpx;\r\n  font-size: 22rpx;\r\n}\r\n\r\n.role-operator {\r\n  background: #e3f2fd;\r\n  color: #1976d2;\r\n}\r\n\r\n.role-qc {\r\n  background: #fff3e0;\r\n  color: #f57c00;\r\n}\r\n\r\n.role-admin {\r\n  background: #f3e5f5;\r\n  color: #7b1fa2;\r\n}\r\n\r\n.status-badge {\r\n  padding: 4rpx 12rpx;\r\n  border-radius: 12rpx;\r\n  font-size: 22rpx;\r\n}\r\n\r\n.status-badge.active {\r\n  background: #e8f5e9;\r\n  color: #388e3c;\r\n}\r\n\r\n.status-badge.inactive {\r\n  background: #ffebee;\r\n  color: #d32f2f;\r\n}\r\n\r\n.user-actions {\r\n  display: flex;\r\n  gap: 20rpx;\r\n}\r\n\r\n.action-btn {\r\n  padding: 8rpx 16rpx;\r\n  color: #667eea;\r\n  font-size: 26rpx;\r\n  border: 1rpx solid #667eea;\r\n  border-radius: 8rpx;\r\n}\r\n\r\n.action-btn.danger {\r\n  color: #f44336;\r\n  border-color: #f44336;\r\n}\r\n\r\n.empty-tip {\r\n  text-align: center;\r\n  padding: 100rpx;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n\r\n/* 弹窗样式 */\r\n.modal {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n}\r\n\r\n.modal-content {\r\n  width: 90%;\r\n  max-width: 600rpx;\r\n  background: #ffffff;\r\n  border-radius: 20rpx;\r\n  overflow: hidden;\r\n}\r\n\r\n.modal-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 30rpx;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.modal-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.modal-close {\r\n  font-size: 48rpx;\r\n  color: #999;\r\n  line-height: 1;\r\n}\r\n\r\n.modal-body {\r\n  padding: 30rpx;\r\n}\r\n\r\n.form-item {\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.form-label {\r\n  display: block;\r\n  font-size: 26rpx;\r\n  color: #666;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.form-input {\r\n  width: 100%;\r\n  height: 80rpx;\r\n  background: #f5f5f5;\r\n  border-radius: 8rpx;\r\n  padding: 0 20rpx;\r\n  font-size: 28rpx;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.form-picker {\r\n  width: 100%;\r\n  height: 80rpx;\r\n  background: #f5f5f5;\r\n  border-radius: 8rpx;\r\n  padding: 0 20rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 28rpx;\r\n  color: #333;\r\n}\r\n\r\n.switch-group {\r\n  display: flex;\r\n  gap: 20rpx;\r\n}\r\n\r\n.switch-item {\r\n  flex: 1;\r\n  height: 80rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background: #f5f5f5;\r\n  border-radius: 8rpx;\r\n  font-size: 28rpx;\r\n  color: #666;\r\n}\r\n\r\n.switch-item.active {\r\n  background: #667eea;\r\n  color: #ffffff;\r\n}\r\n\r\n.modal-footer {\r\n  display: flex;\r\n  gap: 20rpx;\r\n  padding: 30rpx;\r\n  border-top: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.modal-btn {\r\n  flex: 1;\r\n  height: 80rpx;\r\n  border-radius: 10rpx;\r\n  font-size: 28rpx;\r\n  border: none;\r\n}\r\n\r\n.modal-btn.cancel {\r\n  background: #f5f5f5;\r\n  color: #666;\r\n}\r\n\r\n.modal-btn.confirm {\r\n  background: linear-gradient(135deg, #FFB6C1 0%, #FFB6C1 100%);\r\n  color: #ffffff;\r\n}\r\n\r\n.modal-btn::after {\r\n  border: none;\r\n}\r\n</style>\r\n\r\n","import MiniProgramPage from 'D:/yepian32323232/yepian/叶片质量追溯/pages/user-manage/user-manage.vue'\nwx.createPage(MiniProgramPage)"],"names":["storage","uni","get","put","post"],"mappings":"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"}