# 微信小程序前端测试指南

## 1. 环境准备

### 1.1 安装开发工具

1. **HBuilderX** (推荐)
   - 下载地址：https://www.dcloud.io/hbuilderx.html
   - 选择"App开发版"

2. **微信开发者工具**
   - 下载地址：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
   - 用于真机预览和调试

### 1.2 项目配置

1. 在 HBuilderX 中打开项目：`叶片质量追溯`
2. 配置小程序 AppID（在 `manifest.json` 中）

---

## 2. 使用 Mock 数据测试（后端未就绪时）

### 2.1 创建 Mock 服务

由于后端可能还未准备好，我们可以使用 Mock 数据进行测试。

**方法一：使用 Mock.js（推荐）**

1. 安装 Mock.js：
```bash
npm install mockjs --save-dev
```

2. 创建 Mock 文件：`utils/mock.js`

3. 在 `utils/request.js` 中添加 Mock 开关

**方法二：使用本地 JSON 文件**

创建 `mock/data.json` 文件，直接返回模拟数据。

### 2.2 修改请求拦截

在 `utils/request.js` 中添加 Mock 模式：

```javascript
// 开发环境使用 Mock 数据
const USE_MOCK = true  // 改为 false 使用真实接口

if (USE_MOCK) {
  // 返回 Mock 数据
  return mockRequest(options)
}
```

---

## 3. 测试步骤

### 3.1 启动项目

1. 在 HBuilderX 中：
   - 点击"运行" → "运行到小程序模拟器" → "微信开发者工具"
   - 或直接点击工具栏的运行按钮

2. 微信开发者工具会自动打开并加载项目

### 3.2 测试登录功能

1. 打开小程序，进入登录页
2. 输入测试账号（需要后端支持，或使用 Mock 数据）
3. 测试登录流程

**Mock 登录数据示例**：
```javascript
// 模拟登录成功
{
  code: 200,
  data: {
    token: 'mock_token_123456',
    userInfo: {
      operator_id: 1,
      operator_name: '张三',
      role: 'OPERATOR',
      is_active: 1
    }
  }
}
```

### 3.3 测试扫码功能

1. 点击"扫码追溯"按钮
2. 测试扫码功能（需要真机测试）
3. 或使用手动输入叶片ID功能

**测试二维码内容**：
```
B1|P1:1,2:2,3:3,4:4,5:5
```

### 3.4 测试追溯详情页

1. 扫码或输入叶片ID后进入追溯详情页
2. 检查：
   - 叶片信息是否正确显示
   - 工序列表是否正确
   - 操作员只能看到自己操作的工序
   - 质检员可以看到所有工序

### 3.5 测试角色权限

**测试操作员权限**：
1. 使用操作员账号登录
2. 查看首页功能菜单
3. 查看追溯详情，确认只能看到自己操作的工序

**测试质检员权限**：
1. 使用质检员账号登录
2. 查看首页功能菜单（应包含"质检录入"）
3. 查看追溯详情，确认可以看到所有工序
4. 测试填写质检报告功能

---

## 4. 调试技巧

### 4.1 控制台调试

在代码中使用 `console.log()`：
```javascript
console.log('用户信息:', this.userInfo)
console.log('工序列表:', this.processes)
```

在微信开发者工具中查看控制台输出。

### 4.2 网络请求调试

1. 打开微信开发者工具
2. 点击"Network"标签
3. 查看所有网络请求和响应

### 4.3 存储调试

在控制台输入：
```javascript
// 查看存储的数据
console.log(uni.getStorageSync('token'))
console.log(uni.getStorageSync('userInfo'))
```

### 4.4 页面调试

1. 在微信开发者工具中点击"调试器"
2. 可以查看页面结构、样式、数据等

---

## 5. 真机测试

### 5.1 预览到手机

1. 在微信开发者工具中点击"预览"
2. 扫描二维码在手机上打开
3. 测试扫码功能（真机才能测试扫码）

### 5.2 真机调试

1. 在微信开发者工具中点击"真机调试"
2. 选择调试方式（USB调试或网络调试）
3. 在手机上操作，在开发者工具中查看日志

---

## 6. 常见问题

### 6.1 登录失败

**问题**：登录后跳转失败或提示错误

**解决**：
- 检查 `pages.json` 中的路由配置
- 检查 `storage.js` 中的存储逻辑
- 查看控制台错误信息

### 6.2 扫码功能无法使用

**问题**：点击扫码没有反应

**解决**：
- 真机测试（模拟器不支持扫码）
- 检查 `manifest.json` 中的权限配置
- 使用手动输入功能测试

### 6.3 数据不显示

**问题**：页面显示空白或加载失败

**解决**：
- 检查 API 地址配置
- 检查网络请求是否成功
- 查看控制台错误信息
- 使用 Mock 数据测试

### 6.4 权限控制不生效

**问题**：操作员能看到所有工序

**解决**：
- 检查 `canViewProcess` 方法逻辑
- 确认后端返回的数据中包含 `operator_id`
- 检查用户角色是否正确

---

## 7. 测试清单

- [ ] 登录功能正常
- [ ] 不同角色显示不同界面
- [ ] 扫码功能正常（真机测试）
- [ ] 手动输入叶片ID功能正常
- [ ] 追溯详情页数据正确显示
- [ ] 操作员只能看到自己操作的工序
- [ ] 质检员可以看到所有工序
- [ ] 质检报告填写功能正常
- [ ] 页面跳转正常
- [ ] 数据存储正常
- [ ] 错误提示友好

---

## 8. 性能测试

1. **页面加载速度**：检查页面首次加载时间
2. **数据请求速度**：检查 API 响应时间
3. **内存使用**：在开发者工具中查看内存占用
4. **网络请求优化**：检查是否有重复请求

---

## 9. 兼容性测试

1. **iOS 测试**：在 iPhone 上测试
2. **Android 测试**：在不同 Android 版本上测试
3. **微信版本**：在不同微信版本上测试

---

## 10. 下一步

1. 连接真实后端 API
2. 修改 `utils/config.js` 中的 API 地址
3. 关闭 Mock 模式
4. 进行集成测试

